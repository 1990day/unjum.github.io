<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš´ì  - ì •í†µ ë§Œì„¸ë ¥ (Ultimate Fix)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.6.12/lunar.js"></script>
    <style>
        @font-face {
            font-family: 'ThinRounded';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/ThinDungGeunMo.woff2') format('woff2');
            font-weight: normal; font-style: normal; font-display: swap;
        }

        :root {
            --bg-main: #020617;       
            --bg-container: #0f172a;  
            --bg-input: #1e293b;      
            --border-color: #334155;  
            --text-main: #e2e8f0;     
            --text-sub: #94a3b8;      
            --accent: #38bdf8;        
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }

        body {
            font-family: 'ThinRounded', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6; overflow-x: hidden; font-size: 16px;
        }

        /* --- [ìˆ˜ì •] í—¤ë” ìŠ¤íƒ€ì¼ --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background-color: var(--bg-container); display: flex; justify-content: space-between;
            align-items: center; padding: 0 20px; z-index: 1000; border-bottom: 1px solid var(--border-color);
        }
        /* ë¡œê³  ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ ë³µêµ¬ */
        .logo img { height: 35px; width: auto; } /* ë†’ì´ ì‚´ì§ ì¡°ì • */

        /* [PCìš©] ìƒë‹¨ ë©”ë‰´ */
        .top-menu { display: flex; gap: 15px; }
        .top-menu a { color: var(--text-sub); text-decoration: none; font-size: 0.9rem; cursor: pointer; }
        .top-menu a:hover { color: var(--accent); }

        /* [ëª¨ë°”ì¼ìš©] í–„ë²„ê±° ë²„íŠ¼ (PC ìˆ¨ê¹€) */
        .hamburger-btn {
            display: none; flex-direction: column; justify-content: space-between;
            width: 30px; height: 21px; cursor: pointer; z-index: 1100;
        }
        .hamburger-btn span {
            display: block; width: 100%; height: 3px;
            background-color: var(--accent); /* í…Œë§ˆ ì»¬ëŸ¬ ì ìš© */
            border-radius: 3px; transition: all 0.3s ease;
        }
        .hamburger-btn.active span:nth-child(1) { transform: translateY(9px) rotate(45deg); }
        .hamburger-btn.active span:nth-child(2) { opacity: 0; }
        .hamburger-btn.active span:nth-child(3) { transform: translateY(-9px) rotate(-45deg); }

        /* [ìˆ˜ì •] ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            position: fixed; top: 60px; left: 0; width: 240px;
            height: calc(100vh - 60px); background-color: var(--bg-container);
            padding: 20px; overflow-y: auto; border-right: 1px solid var(--border-color);
            z-index: 100; transition: left 0.3s ease-in-out; /* ìŠ¬ë¼ì´ë“œ íš¨ê³¼ */
        }
        .category-title { font-size: 1.1rem; color: var(--accent); margin-bottom: 10px; display: block; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
        .sub-menu { list-style: none; padding-left: 10px; }
        .sub-menu li { margin: 8px 0; }
        .sub-menu a { color: var(--text-sub); text-decoration: none; font-size: 1rem; cursor: pointer; }
        .sub-menu a:hover { color: #fff; }

        /* [ì¶”ê°€] ëª¨ë°”ì¼ìš© ì˜¤ë²„ë ˆì´ */
        .overlay {
            display: none; position: fixed; top: 60px; left: 0;
            width: 100%; height: calc(100vh - 60px);
            background-color: rgba(0, 0, 0, 0.7); z-index: 90; opacity: 0; transition: opacity 0.3s ease;
        }
        .overlay.active { display: block; opacity: 1; }

        /* [ìˆ˜ì •] ë©”ì¸ ì˜ì—­ */
        main {
            margin-top: 60px; margin-left: 240px;
            padding: 40px 20px; display: flex; justify-content: center;
            transition: margin-left 0.3s ease;
        }
        
        .fortune-page { width: 100%; max-width: 900px; text-align: center; }
        .page-title { font-size: 2rem; color: var(--accent); margin-bottom: 25px; text-shadow: 0 0 10px rgba(56, 189, 248, 0.3); }

        .input-card {
            background: var(--bg-container); padding: 25px; border-radius: 15px;
            border: 1px solid var(--border-color); text-align: left; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); margin-bottom: 40px;
        }
        .input-row { margin-bottom: 15px; }
        .input-row label { display: block; margin-bottom: 5px; color: var(--accent); font-size: 0.95rem; }
        
        .select-group { display: flex; gap: 5px; width: 100%; }
        select, input[type="text"] {
            flex: 1; padding: 12px; background-color: var(--bg-input); color: var(--text-main);
            border: 1px solid var(--border-color); border-radius: 8px; font-family: 'ThinRounded'; font-size: 1rem;
            height: 50px; outline: none; transition: 0.3s;
        }
        select:focus, input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2); }

        .type-toggle { display: flex; gap: 5px; margin-top: 5px; }
        .type-btn { 
            flex: 1; padding: 12px; background: var(--bg-input); border: 1px solid var(--border-color); 
            color: var(--text-sub); border-radius: 8px; cursor: pointer; text-align: center; font-size: 0.9rem; transition: 0.3s;
        }
        .type-btn.active { background: #0ea5e9; color: #fff; border-color: var(--accent); font-weight: bold; }
        
        .submit-btn {
            width: 100%; padding: 16px; background: linear-gradient(135deg, #0ea5e9, #2563eb); color: #fff;
            border: none; border-radius: 8px; font-size: 1.3rem; font-weight: bold; cursor: pointer; 
            margin-top: 20px; transition: 0.3s; box-shadow: 0 0 15px rgba(14, 165, 233, 0.4);
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(14, 165, 233, 0.6); }

        #result-area { display: none; animation: fadeIn 0.6s ease; text-align: left; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .analysis-section { 
            margin-bottom: 30px; background: var(--bg-container); padding: 25px; border-radius: 15px; 
            border: 1px solid var(--border-color); box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .section-header { 
            font-size: 1.4rem; color: var(--text-main); margin-bottom: 20px; border-bottom: 2px solid var(--accent); 
            padding-bottom: 10px; font-weight:bold; display: flex; justify-content: space-between; align-items: flex-end;
        }
        .header-sub { font-size: 0.85rem; color: #94a3b8; font-weight: normal; }

        /* ë§Œì„¸ë ¥ ê·¸ë¦¬ë“œ */
        .manse-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .pillar-box {
            background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 12px;
            text-align: center; padding: 20px 5px; position: relative;
        }
        .pillar-box.me { border: 2px solid var(--accent); background: rgba(56, 189, 248, 0.1); box-shadow: 0 0 15px rgba(56, 189, 248, 0.1); }
        
        .pillar-title { font-size: 1rem; color: var(--accent); margin-bottom: 10px; font-weight: bold; }
        .ten-god-tag { 
            font-size: 0.85rem; background: #0f172a; padding: 4px 8px; border-radius: 6px; 
            margin-bottom: 10px; display: inline-block; color: var(--text-sub); border: 1px solid var(--border-color);
        }
        
        .char-box { margin: 8px 0; }
        .hanja { 
            font-family: serif; font-size: 3.5rem; font-weight: bold; line-height: 1.1; 
            display: block; text-shadow: 0 0 10px rgba(0,0,0,0.5); 
        }
        .hangul { font-size: 0.9rem; opacity: 0.7; display: block; margin-top: 2px; }
        .sub-info { 
            font-size: 0.9rem; color: var(--text-sub); margin-top: 15px; 
            border-top: 1px dashed var(--border-color); width: 100%; padding-top: 10px; 
        }

        /* ì‹ ì‚´ ìƒì„¸ (ë³„ë„ ì˜ì—­) */
        .shinsal-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .shinsal-box {
            background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 10px; padding: 15px 10px;
            min-height: 120px; display: flex; flex-direction: column; gap: 6px;
        }
        .shinsal-title { text-align: center; color: var(--text-sub); font-size: 0.9rem; margin-bottom: 5px; border-bottom: 1px solid var(--border-color); padding-bottom:5px; }
        
        .ss-tag { 
            font-size: 0.85rem; padding: 5px 8px; border-radius: 4px; font-weight: bold; 
            text-align: center; line-height: 1.3; border: 1px solid; cursor: pointer; transition: 0.2s;
        }
        .ss-tag:active { transform: scale(0.95); }
        .ss-good { background: rgba(16, 185, 129, 0.15); color: #34d399; border-color: #059669; }
        .ss-bad { background: rgba(239, 68, 68, 0.15); color: #f87171; border-color: #b91c1c; }
        .ss-neu { background: rgba(59, 130, 246, 0.15); color: #60a5fa; border-color: #1d4ed8; }

        .wood { color: #4ade80; text-shadow: 0 0 5px rgba(74, 222, 128, 0.3); } 
        .fire { color: #f87171; text-shadow: 0 0 5px rgba(248, 113, 113, 0.3); } 
        .earth { color: #facc15; text-shadow: 0 0 5px rgba(250, 204, 21, 0.3); } 
        .metal { color: #e2e8f0; text-shadow: 0 0 5px rgba(226, 232, 240, 0.3); } 
        .water { color: #60a5fa; text-shadow: 0 0 5px rgba(96, 165, 250, 0.3); }

        .ohaeng-bar-wrap { width: 100%; height: 30px; background: var(--bg-input); border-radius: 15px; overflow: hidden; display: flex; margin-bottom: 15px; border: 1px solid var(--border-color); }
        .ohaeng-seg { height: 100%; transition: width 1s; }
        .ohaeng-seg.wood { background: #4ade80; } .ohaeng-seg.fire { background: #f87171; }
        .ohaeng-seg.earth { background: #facc15; } .ohaeng-seg.metal { background: #94a3b8; } .ohaeng-seg.water { background: #3b82f6; }
        .ohaeng-legend { display: flex; justify-content: space-around; font-size: 1rem; color: var(--text-main); font-weight: bold; }

        .daewoon-scroll { overflow-x: auto; padding-bottom: 10px; }
        .daewoon-wrap { display: flex; gap: 10px; min-width: 600px; }
        .daewoon-card { 
            flex: 1; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: 8px; 
            padding: 15px 0; text-align: center; 
        }

        /* Toast Message */
        #toast {
            visibility: hidden; min-width: 300px; max-width: 90%; 
            background-color: rgba(15, 23, 42, 0.98); color: #fff; text-align: center; 
            border-radius: 8px; padding: 16px; position: fixed; z-index: 2000; 
            left: 50%; bottom: 40px; transform: translateX(-50%);
            border: 1px solid #38bdf8; box-shadow: 0 10px 25px rgba(0,0,0,0.7); 
            font-size: 1rem; line-height: 1.5; word-break: keep-all;
        }
        #toast.show { visibility: visible; animation: fadein 0.3s, fadeout 0.5s 3.5s; }
        @keyframes fadein { from {bottom: 20px; opacity: 0;} to {bottom: 40px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 40px; opacity: 1;} to {bottom: 20px; opacity: 0;} }

        /* --- [ìˆ˜ì •] ë°˜ì‘í˜• (768px ì´í•˜) --- */
        @media (max-width: 768px) {
            header { padding: 0 20px; height: 60px; }
            .logo img { height: 28px; } /* ëª¨ë°”ì¼ì—ì„œ ë¡œê³  í¬ê¸° ì¡°ì • */
            
            /* ë©”ë‰´ ì œì–´ */
            .top-menu { display: none; }
            .hamburger-btn { display: flex; }

            /* ì‚¬ì´ë“œë°” ì œì–´ */
            .sidebar { left: -270px; top: 60px; height: calc(100vh - 60px); }
            .sidebar.open { left: 0; }
            .overlay { top: 60px; height: calc(100vh - 60px); }

            /* ë©”ì¸ ì˜ì—­ ì œì–´ */
            main { margin-left: 0; margin-top: 60px; padding: 20px 10px; }
            
            .fortune-page { width: 100%; }
            .hanja { font-size: 2.5rem; } 
            .pillar-box { padding: 10px 2px; }
            .select-group { flex-direction: column; }
            select { margin-bottom: 5px; }
            .shinsal-grid { grid-template-columns: repeat(2, 1fr); }
            /* ëª¨ë°”ì¼ì—ì„œ ì œëª©ê³¼ ì„¤ëª… ë¶„ë¦¬ */
            .section-header { flex-direction: column; align-items: flex-start; gap: 5px; }
            .header-sub { display: block; margin-top: 3px; font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo"><img src="img_logo1.png" alt="logo"></a>
        
        <nav class="top-menu">
            <a href="today_fortune.html">ìš´ì„¸</a>
            <a href="manse_calendar.html" style="color:var(--accent);">ì‚¬ì£¼</a>
            <a href="love-fortune.html">ì—°ì• </a>
            <a href="charm-score.html">ë„íŒŒë¯¼</a>
            <a href="weekly-zodiac.html">ë³„ìë¦¬</a>
        </nav>

        <div class="hamburger-btn" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <div class="overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="menu-category">
            <span class="category-title">ìš´ì„¸</span>
            <ul class="sub-menu">
                <li><a href="today_fortune.html">ì˜¤ëŠ˜ì˜ ìš´ì„¸</a></li>
                <li><a href="new_year_fortune.html">ì‹ ë…„ ìš´ì„¸</a></li>
                <li><a href="lifetime_fortune.html">í‰ìƒ ìš´ì„¸</a></li>
            </ul>
        </div>
        <div class="menu-category">
            <span class="category-title">ì‚¬ì£¼</span>
            <ul class="sub-menu">
                <li><a href="manse_calendar.html" style="color:var(--accent); font-weight:bold;">ì •í†µ ë§Œì„¸ë ¥</a></li>
                <li><a href="traditional_saju.html">ì •í†µ ì‚¬ì£¼</a></li>
                <li><a href="my_saju.html">ë‚´ ì‚¬ì£¼ í’€ì´</a></li>
            </ul>
        </div>
        <div class="menu-category">
            <span class="category-title">ì—°ì• </span>
            <ul class="sub-menu">
                <li><a href="love-fortune.html">í‰ìƒ ì—°ì• ìš´</a></li>
                <li><a href="saju-compatibility.html">ì‚¬ì£¼ ê¶í•©</a></li>
                <li><a href="reunion-saju.html">ì¬íšŒ ì‚¬ì£¼</a></li>
            </ul>
        </div>
        <div class="menu-category">
            <span class="category-title">ë„íŒŒë¯¼</span>
            <ul class="sub-menu">
                <li><a href="charm-score.html">ë‚´ ì‚¬ì£¼ì˜ ë§¤ë ¥ë„</a></li>
                <li><a href="saju-popularity.html">ì‚¬ì£¼ì— ìˆëŠ” ì¸ê¸°ìš´</a></li>
                <li><a href="dohwasal-check.html">ë„í™”ì‚´ ì§„ë‹¨ê¸°</a></li>
                <li><a href="saju-spotlight.html">ì£¼ëª©ë°›ëŠ” ì‚¬ì£¼</a></li>
            </ul>
        </div>
        <div class="menu-category">
            <span class="category-title">ë³„ìë¦¬</span>
            <ul class="sub-menu">
                <li><a href="weekly-zodiac.html">ì´ë²ˆì£¼ ë³„ìë¦¬ ìš´ì„¸</a></li>
                <li><a href="monthly-zodiac.html">ì´ë²ˆë‹¬ ë³„ìë¦¬ ìš´ì„¸</a></li>
            </ul>
        </div>
    </aside>

    <main>
        <div class="fortune-page">
            <h2 class="page-title">ì •í†µ ì‚¬ì£¼ ì •ë°€ ë¶„ì„</h2>
            
            <div class="input-card">
                <div class="input-row">
                    <label>ì´ë¦„ / ì„±ë³„</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                        <div class="type-toggle" style="margin-top:0; width:140px;">
                            <div id="maleBtn" class="type-btn active" onclick="setGender('m')">ë‚¨ì„±</div>
                            <div id="femaleBtn" class="type-btn" onclick="setGender('f')">ì—¬ì„±</div>
                        </div>
                    </div>
                </div>
                <div class="input-row">
                    <label>ìƒë…„ì›”ì¼ì‹œ</label>
                    <div class="select-group">
                        <select id="yearSelect"></select>
                        <select id="monthSelect"></select>
                        <select id="daySelect"></select>
                    </div>
                    <div class="select-group" style="margin-top:8px;">
                        <select id="hourSelect">
                            <option value="99">ì‹œê°„ ëª¨ë¦„</option>
                            <option value="0">ìì‹œ (23:30 ~ 01:29)</option><option value="2">ì¶•ì‹œ (01:30 ~ 03:29)</option>
                            <option value="4">ì¸ì‹œ (03:30 ~ 05:29)</option><option value="6">ë¬˜ì‹œ (05:30 ~ 07:29)</option>
                            <option value="8">ì§„ì‹œ (07:30 ~ 09:29)</option><option value="10">ì‚¬ì‹œ (09:30 ~ 11:29)</option>
                            <option value="12">ì˜¤ì‹œ (11:30 ~ 13:29)</option><option value="14">ë¯¸ì‹œ (13:30 ~ 15:29)</option>
                            <option value="16">ì‹ ì‹œ (15:30 ~ 17:29)</option><option value="18">ìœ ì‹œ (17:30 ~ 19:29)</option>
                            <option value="20">ìˆ ì‹œ (19:30 ~ 21:29)</option><option value="22">í•´ì‹œ (21:30 ~ 23:29)</option>
                        </select>
                        <div class="type-toggle" style="margin-top:0;">
                            <div id="solarBtn" class="type-btn active" onclick="setCalendar('solar')">ì–‘ë ¥</div>
                            <div id="lunarBtn" class="type-btn" onclick="setCalendar('lunar')">ìŒë ¥</div>
                        </div>
                    </div>
                </div>
                <button class="submit-btn" onclick="analyzeSaju()">ë‚´ ì‚¬ì£¼ ë¶„ì„í•˜ê¸°</button>
            </div>

            <div id="result-area">
                
                <div class="analysis-section">
                    <h3 class="section-header">ğŸ“œ ì‚¬ì£¼ íŒ”ì (ì›êµ­)</h3>
                    <div class="manse-grid" id="sajuGrid"></div>
                </div>

                <div class="analysis-section">
                    <h3 class="section-header">
                        âœ¨ ì‹ ì‚´ ë° ê·€ì¸ ìƒì„¸ ë¶„ì„
                        <span class="header-sub">* ê¸¸ì‹ (ì´ˆë¡) / í‰ì‹ (ë¹¨ê°•) / í‰ì‹ (íŒŒë‘)</span>
                    </h3>
                    <div class="shinsal-grid" id="shinsalDetail"></div>
                </div>

                <div class="analysis-section">
                    <h3 class="section-header">ğŸ“Š ì˜¤í–‰ ê¸°ìš´ì˜ ë¶„í¬</h3>
                    <div class="ohaeng-bar-wrap" id="ohaengBar"></div>
                    <div class="ohaeng-legend">
                        <div><span class="wood" id="cnt-wood">0</span> ëª©</div>
                        <div><span class="fire" id="cnt-fire">0</span> í™”</div>
                        <div><span class="earth" id="cnt-earth">0</span> í† </div>
                        <div><span class="metal" id="cnt-metal">0</span> ê¸ˆ</div>
                        <div><span class="water" id="cnt-water">0</span> ìˆ˜</div>
                    </div>
                </div>

                <div class="analysis-section">
                    <h3 class="section-header">ğŸŒŠ ëŒ€ìš´ì˜ íë¦„ (<span id="directionText" style="color:var(--accent)"></span>)</h3>
                    <div class="daewoon-scroll">
                        <div class="daewoon-wrap" id="daewoonList"></div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <div id="toast"></div>

    <script>
        // [ì¶”ê°€] í–„ë²„ê±° í† ê¸€ í•¨ìˆ˜
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            const hamburger = document.querySelector('.hamburger-btn');

            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        let gender = 'm';
        let calendarType = 'solar';

        // â˜… ì‚´ ì„¤ëª… ë°ì´í„° (ì™„ë²½ ë§¤ì¹­) â˜…
        const SHINSAL_DESC = {
            "ì²œì„ê·€ì¸": "ìµœê³ ì˜ ê¸¸ì‹ . ì–´ë ¤ì›€ì— ì²˜í–ˆì„ ë•Œ ë•ëŠ” ê·€ì¸ì´ ë‚˜íƒ€ë‚˜ë©° ì¸ë•ì´ ìˆìŠµë‹ˆë‹¤.",
            "ë¬¸ì°½ê·€ì¸": "ì´ëª…í•˜ê³  í•™ë¬¸ì  ì„±ì·¨ê°€ ë›°ì–´ë‚©ë‹ˆë‹¤. ê¸€ê³¼ ë§ì— ì¬ëŠ¥ì´ ìˆì–´ êµìœ¡ê³„ì— ì¢‹ìŠµë‹ˆë‹¤.",
            "íƒœê·¹ê·€ì¸": "ì‹œì‘ê³¼ ëì´ ì¢‹ìœ¼ë©°, ì¡°ìƒì˜ ìŒë•ì„ ë°›ì•„ ìƒê°ì§€ ì•Šì€ ë³µì„ ë°›ìŠµë‹ˆë‹¤.",
            "ê¸ˆì—¬ë¡": "ì¢‹ì€ ë°°ìš°ìë¥¼ ë§Œë‚˜ê³  ì¬ë¬¼ìš´ì´ ë”°ë¥´ëŠ” ê·€í•œ ìš´ì…ë‹ˆë‹¤. ì˜ì‹ì£¼ê°€ í’ì¡±í•©ë‹ˆë‹¤.",
            "ì•”ë¡": "ë³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œ ë‚˜ë¥¼ ë•ëŠ” ì†ê¸¸ì´ ìˆì–´ ì¬ë¬¼ì´ ëŠì´ì§€ ì•Šê³  ìœ„ê¸°ë¥¼ ë„˜ê¹ë‹ˆë‹¤.",
            "ì²œë•ê·€ì¸": "í•˜ëŠ˜ì˜ ë•ì„ ë°›ì•„ í‰í•œ ì¼ì„ í”¼í•˜ê³  ì „í™”ìœ„ë³µì´ ë©ë‹ˆë‹¤. ê´€ì¬êµ¬ì„¤ì„ ë§‰ì•„ì¤ë‹ˆë‹¤.",
            "ì›”ë•ê·€ì¸": "ë‹¬ì˜ ë•ì„ ì…ì–´ ì¸ë³µì´ ìˆê³  ë§¤ì‚¬ ìˆœì¡°ë¡­ê²Œ í’€ë¦¬ëŠ” ê¸¸ì‹ ì…ë‹ˆë‹¤.",
            
            "ë°±í˜¸ëŒ€ì‚´": "ê°•í•œ í­ë°œë ¥. ì‚¬ê³ ìˆ˜ê°€ ìˆìœ¼ë‚˜, ì „ë¬¸ì§(ì˜ë£Œ, ë²•ì¡°)ì´ë‚˜ íŠ¹ìˆ˜ ë¶„ì•¼ì—ì„œ í¬ê²Œ ì„±ê³µí•©ë‹ˆë‹¤.",
            "ê´´ê°•ì‚´": "ìš°ë‘ë¨¸ë¦¬ ê¸°ì§ˆ. ì´ëª…í•˜ê³  ê²°ë‹¨ë ¥ì´ ìˆì–´ ë¦¬ë”ê°€ ë˜ì§€ë§Œ ì‚¶ì˜ êµ´ê³¡ì´ í´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì–‘ì¸ì‚´": "ê°•ë ¥í•œ ë¦¬ë”ì‹­ê³¼ ê²½ìŸì‹¬. ì¹¼ì„ ë‹¤ë£¨ëŠ” ì§ì—…(ì˜ì‚¬, êµ°ì¸, ê²½ì°°)ì— ì¢…ì‚¬í•˜ë©´ ëŒ€ì„±í•©ë‹ˆë‹¤.",
            "ê³ ë€ì‚´": "ì™¸ë¡œì›€ì„ ëŠë¼ê¸° ì‰½ê³  ë°°ìš°ì ìš´ì´ ì•½í•  ìˆ˜ ìˆìœ¼ë‚˜, ì‚¬íšŒì  ì„±ì·¨ëŠ” ê°•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "íš¨ì‹ ì‚´": "ì–´ë¨¸ë‹ˆì™€ì˜ ì¸ì—°ì´ ê°ë³„í•˜ê±°ë‚˜ ê°ˆë“±ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìë¦½ì‹¬ì„ í‚¤ì›Œì•¼ í•©ë‹ˆë‹¤.",
            
            "ê·€ë¬¸ê´€ì‚´": "ì˜ˆë¯¼í•˜ê³  ì§ê°ì´ ë°œë‹¬í•¨. ì˜ˆìˆ ì  ì¬ëŠ¥ì´ ë›°ì–´ë‚˜ë‚˜ ì‹ ê²½ ì‡ ì•½ì´ë‚˜ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.",
            "ì›ì§„ì‚´": "ì´ìœ  ì—†ì´ ì„œë¡œ ë¯¸ì›Œí•˜ê±°ë‚˜ ì›ë§í•˜ëŠ” ê´€ê³„ê°€ ë  ìˆ˜ ìˆì–´ ì¸ê°„ê´€ê³„ë¥¼ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.",
            "ì¶©(æ²–)": "ì„œë¡œ ë¶€ë”ªí˜€ ê¹¨ì§. ë³€í™”, ì´ë™, ì´ë³„ìˆ˜ê°€ ìˆìœ¼ë‚˜ ë‚¡ì€ ê²ƒì„ ê°œí˜í•˜ëŠ” í˜ì´ ë˜ê¸°ë„ í•©ë‹ˆë‹¤.",
            "ì¸ì‚¬ì‹  í˜•": "ê¶Œë ¥ì§€í–¥ì . ìì‹ ì˜ í˜ì„ ë¯¿ê³  ëŒì§„í•˜ë‹¤ ë‹¤ì¹  ìˆ˜ ìˆìœ¼ë‹ˆ ê²¸ì†í•´ì•¼ í•©ë‹ˆë‹¤. (ì‚¼í˜•ì‚´)",
            "ì¶•ìˆ ë¯¸ í˜•": "ë°°ì‹ ì´ë‚˜ ì€í˜œë¥¼ ì›ìˆ˜ë¡œ ê°šëŠ” ì¼ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëƒ‰ì² í•¨ì´ í•„ìš”í•©ë‹ˆë‹¤. (ì‚¼í˜•ì‚´)",
            "ìë¬˜ í˜•": "ë¬´ë¡€ì§€í˜•. ì˜ˆì˜ê°€ ì—†ê³  ì„±ì ì¸ ë¬¸ì œë‚˜ êµ¬ì„¤ìˆ˜ì— ì˜¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ì–¸í–‰ì„ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.",
            "í˜•(åˆ‘)": "ì¡°ì •í•˜ê³  ê¹ì•„ëƒ„. ìˆ˜ìˆ , ì†¡ì‚¬, í˜¹ì€ ë²•/ì˜ë£Œ ë¶„ì•¼ ì§ì—…ê³¼ ê¹Šì€ ê´€ë ¨ì´ ìˆìŠµë‹ˆë‹¤.",
            "íŒŒ(ç ´)": "ê¹¨ëœ¨ë¦¼. ì¼ì´ ì¤‘ë„ì— ë¬´ì‚°ë˜ê±°ë‚˜ ë§ˆë¬´ë¦¬ ë‹¨ê³„ì—ì„œ ì–´ê¸‹ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "í•´(å®³)": "ë°©í•´í•¨. ìœ¡ì¹œ ê°„ì˜ ë¶ˆí™”ë‚˜ ë°°ì‹ ì„ ì¡°ì‹¬í•´ì•¼ í•˜ë©°, ê±´ê°•ì„ ì±™ê²¨ì•¼ í•©ë‹ˆë‹¤.",
            "ìí˜•": "ìŠ¤ìŠ¤ë¡œë¥¼ ë³¶ìŒ. ê³ ì§‘ì´ ì„¸ê³  ì˜ˆë¯¼í•˜ì—¬ ìŠ¤ìŠ¤ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§Œë“­ë‹ˆë‹¤.",
            "íƒ•í™”ì‚´": "í™”ì¬, í™”ìƒ ì¡°ì‹¬. ê°ì • ê¸°ë³µì´ ì‹¬í•´ ë¹„ê´€í•˜ê±°ë‚˜ ìš±í•˜ëŠ” ì„±ì§ˆì„ ë‹¤ìŠ¤ë ¤ì•¼ í•©ë‹ˆë‹¤.",
            "ê¸‰ê°ì‚´": "ë‹¤ë¦¬ë‚˜ ê´€ì ˆ, ì‹ ê²½í†µ ë“± ì‹ ì²´ ë¶€ìƒì´ ë”°ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ë‚™ìƒì„ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.",
            "ìƒë¬¸ì‚´": "ê°€ê¹Œìš´ ì‚¬ëŒì˜ ìƒ(å–ª)ì„ ë‹¹í•˜ê±°ë‚˜ ìš°í™˜ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì¡°ê°ì‚´": "ì§‘ì•ˆì— ìš°í™˜ì´ ìƒê¸°ê±°ë‚˜ ë¬¸ìƒ ê°ˆ ì¼ì´ ë§ì•„ì§‘ë‹ˆë‹¤.",
            
            "í™ì—¼ì‚´": "ë„í™”ë³´ë‹¤ ì€ì€í•œ ë§¤ë ¥. ì´ì„±ì—ê²Œ ì¸ê¸°ê°€ ë§ê³  ì‚¬ë‘ë°›ìœ¼ë‚˜ ìƒ‰ì •ì„ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.",
            "ë„í™”ì‚´": "ë¼ì™€ ë§¤ë ¥ì´ ë„˜ì³ íƒ€ì¸ì˜ ì‹œì„ ì„ ë”. ì—°ì˜ˆ/ì˜ˆìˆ /ë°©ì†¡ ë¶„ì•¼ì—ì„œ ëŒ€ê¸¸í•©ë‹ˆë‹¤.",
            "ì—­ë§ˆì‚´": "í•œê³³ì— ë¨¸ë¬¼ì§€ ëª»í•˜ê³  ì´ë™ì´ ì¦ìŒ. ë¬´ì—­, ì—¬í–‰, ìš´ì†¡ì—… ë“± í™œë™ì ì¸ ì§ì—…ì´ ì¢‹ìŠµë‹ˆë‹¤.",
            "í™”ê°œì‚´": "í™”ë ¤í•¨ì„ ë®ìŒ. ì˜ˆìˆ , ì¢…êµ, ì² í•™ì  ê¹Šì´ê°€ ìˆê³  ì¬ëŠ¥ì´ ë§ìœ¼ë‚˜ ê³ ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ë§ì‹ ì‚´": "ë§ì‹ ì„ ë‹¹í•  ìˆ˜ ìˆìœ¼ë‚˜, ì˜¤íˆë ¤ ìì‹ ì„ ê³¼ê°íˆ ë“œëŸ¬ë‚´ì–´(ì—°ì˜ˆì¸ ë“±) ì¸ê¸°ë¥¼ ì–»ê¸°ë„ í•©ë‹ˆë‹¤.",
            "ì¥ì„±ì‚´": "ì¥êµ°ì˜ ë³„. ì£¼ë„ì ì´ê³  ê¶Œìœ„ë¥¼ ê°€ì§€ë©° ì§‘ë‹¨ì˜ ë¦¬ë”ê°€ ë  ìš´ì…ë‹ˆë‹¤.",
            "ë°˜ì•ˆì‚´": "ë§ì•ˆì¥ì— ì˜¤ë¦„. ì¶œì„¸í•˜ê³  ì§€ìœ„ê°€ ë†’ì•„ì§€ë©° ë§ë…„ì— í¸ì•ˆí•´ì§€ëŠ” ê¸¸ì‹ ì…ë‹ˆë‹¤.",
            "ê²ì‚´": "ë¹¼ì•—ê¹€. ì¬ë¬¼ ì†ì‹¤ì´ë‚˜ ê´€ì¬êµ¬ì„¤ì„ ì£¼ì˜í•´ì•¼ í•˜ë©°, ìš•ì‹¬ì„ ë²„ë ¤ì•¼ í•©ë‹ˆë‹¤.",
            "ì¬ì‚´": "ìˆ˜ì˜¥ì‚´. ê°‡íˆê±°ë‚˜ ê´€ì¬ìˆ˜ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‚˜, ë¨¸ë¦¬ê°€ ë¹„ìƒí•˜ì—¬ ì±…ì‚¬ ì—­í• ì„ ì˜í•©ë‹ˆë‹¤.",
            "ì²œì‚´": "í•˜ëŠ˜ì˜ ë²Œ. ë‚´ í˜ìœ¼ë¡œ ì–´ì©” ìˆ˜ ì—†ëŠ” ì²œì¬ì§€ë³€ì´ë‚˜ ì¥ì• ë¬¼ì„ ë§Œë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ì§€ì‚´": "ë•…ì˜ ì›€ì§ì„. ì—­ë§ˆì™€ ë¹„ìŠ·í•˜ê²Œ ì´ë™ì´ ì¦ê³  ìƒˆë¡œìš´ ì¼ì„ ì‹œì‘í•˜ëŠ” ê¸°ìš´ì…ë‹ˆë‹¤.",
            "ë…„ì‚´": "ë„í™”ì™€ ê°™ìŒ. ì¸ê¸°ë¥¼ ì–»ê³  ì‚¬ëŒì„ ëŒì–´ë“¤ì´ëŠ” ë§¤ë ¥ì´ ìˆìŠµë‹ˆë‹¤.",
            "ì›”ì‚´": "ê³ ì´ˆì‚´. ë‹¬ë°¤ì— ê¸¸ì„ ê±·ë“¯ ì™¸ë¡­ê³  ë‹µë‹µí•  ìˆ˜ ìˆìœ¼ë‚˜, ì¢…êµ/ì² í•™ìœ¼ë¡œ ìŠ¹í™”í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.",
            "ìœ¡í•´ì‚´": "ì—¬ì„¯ ê°€ì§€ í•´ë¡œì›€. ê¸‰í•œ ì„±ê²©ìœ¼ë¡œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìœ¼ë‹ˆ ì¹¨ì°©í•´ì•¼ í•˜ë©°, ì˜ê°ì´ ë°œë‹¬í•©ë‹ˆë‹¤.",
            "í˜„ì¹¨ì‚´": "ì˜ˆë¦¬í•œ ë°”ëŠ˜. ì˜ì‚¬, ë””ìì´ë„ˆ, íƒ€íˆ¬ ë“± ì°Œë¥´ëŠ” ì§ì—…ì´ë‚˜ ì •ë°€í•œ ê¸°ìˆ ì§ì— ì•„ì£¼ ì¢‹ìŠµë‹ˆë‹¤.",
            "ê³µë§": "ë¹„ì–´ìˆìŒ. ë…¸ë ¥ì— ë¹„í•´ ê²°ì‹¤ì´ ì ê±°ë‚˜ í—ˆë¬´í•¨ì„ ëŠë‚„ ìˆ˜ ìˆì–´ ë§ˆìŒì„ ë¹„ì›Œì•¼ í•©ë‹ˆë‹¤."
        };

        window.onload = function() {
            const ys = document.getElementById('yearSelect');
            const ms = document.getElementById('monthSelect');
            const ds = document.getElementById('daySelect');
            for(let i=2030; i>=1930; i--) { let opt = document.createElement("option"); opt.value = i; opt.innerText = i + "ë…„"; ys.appendChild(opt); }
            ys.value = 1995;
            for(let i=1; i<=12; i++) { let opt = document.createElement("option"); opt.value = i; opt.innerText = i + "ì›”"; ms.appendChild(opt); }
            for(let i=1; i<=31; i++) { let opt = document.createElement("option"); opt.value = i; opt.innerText = i + "ì¼"; ds.appendChild(opt); }
        };

        function setGender(g) {
            gender = g;
            document.getElementById('maleBtn').classList.toggle('active', g === 'm');
            document.getElementById('femaleBtn').classList.toggle('active', g === 'f');
        }

        function setCalendar(type) {
            calendarType = type;
            document.getElementById('solarBtn').classList.toggle('active', type === 'solar');
            document.getElementById('lunarBtn').classList.toggle('active', type === 'lunar');
        }

        function showToast(msg) {
            const x = document.getElementById("toast");
            x.innerText = msg;
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 4000); // 4ì´ˆë¡œ ì—°ì¥
        }

        const GAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
        const ZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
        const WUXING = {
            "ç”²":"ëª©", "ä¹™":"ëª©", "å¯…":"ëª©", "å¯":"ëª©", "ä¸™":"í™”", "ä¸":"í™”", "å·³":"í™”", "åˆ":"í™”",
            "æˆŠ":"í† ", "å·±":"í† ", "è¾°":"í† ", "æˆŒ":"í† ", "ä¸‘":"í† ", "æœª":"í† ",
            "åºš":"ê¸ˆ", "è¾›":"ê¸ˆ", "ç”³":"ê¸ˆ", "é…‰":"ê¸ˆ", "å£¬":"ìˆ˜", "ç™¸":"ìˆ˜", "äº¥":"ìˆ˜", "å­":"ìˆ˜"
        };
        const COLOR_CLASS = {"ëª©":"wood", "í™”":"fire", "í† ":"earth", "ê¸ˆ":"metal", "ìˆ˜":"water"};
        const YIN_YANG = {
            "ç”²":1, "ä¹™":0, "ä¸™":1, "ä¸":0, "æˆŠ":1, "å·±":0, "åºš":1, "è¾›":0, "å£¬":1, "ç™¸":0,
            "å­":1, "ä¸‘":0, "å¯…":1, "å¯":0, "è¾°":1, "å·³":0, "åˆ":1, "æœª":0, "ç”³":1, "é…‰":0, "æˆŒ":1, "äº¥":0
        };
        const ZHI_MAIN = {
            "å­":"ç™¸", "ä¸‘":"å·±", "å¯…":"ç”²", "å¯":"ä¹™", "è¾°":"æˆŠ", "å·³":"ä¸™",
            "åˆ":"ä¸", "æœª":"å·±", "ç”³":"åºš", "é…‰":"è¾›", "æˆŒ":"æˆŠ", "äº¥":"å£¬"
        };

        function getTenGod(me, target) {
            if(!target) return "";
            const wMe = WUXING[me]; const wT = WUXING[target];
            const pMe = YIN_YANG[me]; const pT = YIN_YANG[target];
            const same = (pMe === pT);
            if (wMe === wT) return same ? "ë¹„ê²¬" : "ê²ì¬";
            if ((wMe==="ëª©"&&wT==="í™”")||(wMe==="í™”"&&wT==="í† ")||(wMe==="í† "&&wT==="ê¸ˆ")||(wMe==="ê¸ˆ"&&wT==="ìˆ˜")||(wMe==="ìˆ˜"&&wT==="ëª©")) return same ? "ì‹ì‹ " : "ìƒê´€";
            if ((wMe==="ëª©"&&wT==="í† ")||(wMe==="í™”"&&wT==="ê¸ˆ")||(wMe==="í† "&&wT==="ìˆ˜")||(wMe==="ê¸ˆ"&&wT==="ëª©")||(wMe==="ìˆ˜"&&wT==="í™”")) return same ? "í¸ì¬" : "ì •ì¬";
            if ((wT==="ëª©"&&wMe==="í† ")||(wT==="í™”"&&wMe==="ê¸ˆ")||(wT==="í† "&&wMe==="ìˆ˜")||(wT==="ê¸ˆ"&&wMe==="ëª©")||(wT==="ìˆ˜"&&wMe==="í™”")) return same ? "í¸ê´€" : "ì •ê´€";
            if ((wT==="ëª©"&&wMe==="í™”")||(wT==="í™”"&&wMe==="í† ")||(wT==="í† "&&wMe==="ê¸ˆ")||(wT==="ê¸ˆ"&&wMe==="ìˆ˜")||(wT==="ìˆ˜"&&wMe==="ëª©")) return same ? "í¸ì¸" : "ì •ì¸";
            return "";
        }

        const WUNSUNG_LIST = ["ì¥ìƒ","ëª©ìš•","ê´€ëŒ€","ê±´ë¡","ì œì™•","ì‡ ","ë³‘","ì‚¬","ë¬˜","ì ˆ","íƒœ","ì–‘"];
        function getWunsung(dayGan, zhi) {
            if(!zhi) return "";
            const zhiIdx = ZHI.indexOf(zhi);
            let s=0; let fwd=true;
            if (dayGan==="ç”²") s=11; else if (dayGan==="ä¹™") { s=6; fwd=false; }
            else if (dayGan==="ä¸™"||dayGan==="æˆŠ") s=2; else if (dayGan==="ä¸"||dayGan==="å·±") { s=9; fwd=false; }
            else if (dayGan==="åºš") s=5; else if (dayGan==="è¾›") { s=0; fwd=false; }
            else if (dayGan==="å£¬") s=8; else if (dayGan==="ç™¸") { s=3; fwd=false; }
            let idx = fwd ? (zhiIdx - s + 12)%12 : (s - zhiIdx + 12)%12;
            return WUNSUNG_LIST[idx];
        }

        function getExtendedShinsal(dayGan, dayZhi, monthZhi, yearZhi, pillar) {
            if(!pillar.zhi) return [];
            let list = [];
            const tGan = pillar.gan; const tZhi = pillar.zhi;

            if((dayGan==="ç”²"||dayGan==="æˆŠ"||dayGan==="åºš") && (tZhi==="ä¸‘"||tZhi==="æœª")) list.push({n:"ì²œì„ê·€ì¸", t:"good"});
            if((dayGan==="ä¹™"||dayGan==="å·±") && (tZhi==="å­"||tZhi==="ç”³")) list.push({n:"ì²œì„ê·€ì¸", t:"good"});
            if((dayGan==="ä¸™"||dayGan==="ä¸") && (tZhi==="äº¥"||tZhi==="é…‰")) list.push({n:"ì²œì„ê·€ì¸", t:"good"});
            if((dayGan==="è¾›") && (tZhi==="åˆ"||tZhi==="å¯…")) list.push({n:"ì²œì„ê·€ì¸", t:"good"});
            if((dayGan==="å£¬"||dayGan==="ç™¸") && (tZhi==="å·³"||tZhi==="å¯")) list.push({n:"ì²œì„ê·€ì¸", t:"good"});

            const mc = {"ç”²":"å·³", "ä¹™":"åˆ", "ä¸™":"ç”³", "ä¸":"é…‰", "æˆŠ":"ç”³", "å·±":"é…‰", "åºš":"äº¥", "è¾›":"å­", "å£¬":"å¯…", "ç™¸":"å¯"};
            if(mc[dayGan] === tZhi) list.push({n:"ë¬¸ì°½ê·€ì¸", t:"good"});

            if((dayGan==="ç”²"||dayGan==="ä¹™") && (tZhi==="å­"||tZhi==="åˆ")) list.push({n:"íƒœê·¹ê·€ì¸", t:"good"});
            if((dayGan==="ä¸™"||dayGan==="ä¸") && (tZhi==="å¯"||tZhi==="é…‰")) list.push({n:"íƒœê·¹ê·€ì¸", t:"good"});
            if((dayGan==="æˆŠ"||dayGan==="å·±") && ["è¾°","æˆŒ","ä¸‘","æœª"].includes(tZhi)) list.push({n:"íƒœê·¹ê·€ì¸", t:"good"});
            if((dayGan==="åºš"||dayGan==="è¾›") && (tZhi==="å¯…"||tZhi==="äº¥")) list.push({n:"íƒœê·¹ê·€ì¸", t:"good"});
            if((dayGan==="å£¬"||dayGan==="ç™¸") && (tZhi==="å·³"||tZhi==="ç”³")) list.push({n:"íƒœê·¹ê·€ì¸", t:"good"});

            const geum = {"ç”²":"è¾°", "ä¹™":"å·³", "ä¸™":"æœª", "ä¸":"ç”³", "æˆŠ":"æœª", "å·±":"ç”³", "åºš":"æˆŒ", "è¾›":"äº¥", "å£¬":"ä¸‘", "ç™¸":"å¯…"};
            if(geum[dayGan] === tZhi) list.push({n:"ê¸ˆì—¬ë¡", t:"good"});

            const am = {"ç”²":"äº¥", "ä¹™":"æˆŒ", "ä¸™":"ç”³", "ä¸":"æœª", "æˆŠ":"ç”³", "å·±":"æœª", "åºš":"å·³", "è¾›":"è¾°", "å£¬":"å¯…", "ç™¸":"ä¸‘"};
            if(am[dayGan] === tZhi) list.push({n:"ì•”ë¡", t:"good"});

            // ì²œë•ê·€ì¸
            const cheon = {"å¯…":"ä¸", "å¯":"ç”³", "è¾°":"å£¬", "å·³":"è¾›", "åˆ":"äº¥", "æœª":"ç”²", "ç”³":"ç™¸", "é…‰":"å¯…", "æˆŒ":"ä¸™", "äº¥":"ä¹™", "å­":"å·³", "ä¸‘":"åºš"};
            if(cheon[monthZhi] && (cheon[monthZhi] === tGan || cheon[monthZhi] === tZhi)) list.push({n:"ì²œë•ê·€ì¸", t:"good"});

            // ì›”ë•ê·€ì¸ (ì¶”ê°€)
            // ì¸ì˜¤ìˆ -ë³‘, ì‹ ìì§„-ì„, í•´ë¬˜ë¯¸-ê°‘, ì‚¬ìœ ì¶•-ê²½
            let wd = "";
            if(["å¯…","åˆ","æˆŒ"].includes(monthZhi)) wd = "ä¸™";
            else if(["ç”³","å­","è¾°"].includes(monthZhi)) wd = "å£¬";
            else if(["äº¥","å¯","æœª"].includes(monthZhi)) wd = "ç”²";
            else if(["å·³","é…‰","ä¸‘"].includes(monthZhi)) wd = "åºš";
            if(wd === tGan) list.push({n:"ì›”ë•ê·€ì¸", t:"good"});

            if(["ç”²åˆ","ä¸™å¯…","ä¸æœª","æˆŠè¾°","åºšæˆŒ","è¾›é…‰","å£¬å­","ç™¸ç”³"].includes(dayGan+tZhi)) list.push({n:"í™ì—¼ì‚´", t:"neu"});

            if(["ç”²è¾°","ä¹™æœª","ä¸™æˆŒ","ä¸ä¸‘","æˆŠè¾°","å£¬æˆŒ","ç™¸ä¸‘"].includes(tGan+tZhi)) list.push({n:"ë°±í˜¸ëŒ€ì‚´", t:"bad"});
            if(["åºšè¾°","åºšæˆŒ","å£¬è¾°","å£¬æˆŒ","æˆŠæˆŒ"].includes(tGan+tZhi)) list.push({n:"ê´´ê°•ì‚´", t:"bad"});
            
            if((dayGan==="ç”²"&&tZhi==="å¯")||(dayGan==="ä¸™"&&tZhi==="åˆ")||(dayGan==="æˆŠ"&&tZhi==="åˆ")||(dayGan==="åºš"&&tZhi==="é…‰")||(dayGan==="å£¬"&&tZhi==="å­")) list.push({n:"ì–‘ì¸ì‚´", t:"bad"});
            
            if(["ç”²","ç”³","å¯","åˆ","è¾›"].includes(tGan) || ["ç”²","ç”³","å¯","åˆ","è¾›"].includes(tZhi)) list.push({n:"í˜„ì¹¨ì‚´", t:"neu"});

            const gwi = {"å­":"é…‰", "é…‰":"å­", "ä¸‘":"åˆ", "åˆ":"ä¸‘", "å¯…":"æœª", "æœª":"å¯…", "å¯":"ç”³", "ç”³":"å¯", "è¾°":"äº¥", "äº¥":"è¾°", "å·³":"æˆŒ", "æˆŒ":"å·³"};
            const won = {"å­":"æœª", "æœª":"å­", "ä¸‘":"åˆ", "åˆ":"ä¸‘", "å¯…":"é…‰", "é…‰":"å¯…", "å¯":"ç”³", "ç”³":"å¯", "è¾°":"äº¥", "äº¥":"è¾°", "å·³":"æˆŒ", "æˆŒ":"å·³"};
            if(gwi[dayZhi] === tZhi) list.push({n:"ê·€ë¬¸ê´€ì‚´", t:"bad"});
            if(won[dayZhi] === tZhi) list.push({n:"ì›ì§„ì‚´", t:"bad"});

            const chung = {"å­":"åˆ", "åˆ":"å­", "ä¸‘":"æœª", "æœª":"ä¸‘", "å¯…":"ç”³", "ç”³":"å¯…", "å¯":"é…‰", "é…‰":"å¯", "è¾°":"æˆŒ", "æˆŒ":"è¾°", "å·³":"äº¥", "äº¥":"å·³"};
            if(chung[dayZhi] === tZhi) list.push({n:"ì¶©(æ²–)", t:"bad"});
            
            if((dayZhi==="å¯…"&&tZhi==="å·³")||(dayZhi==="å·³"&&tZhi==="ç”³")||(dayZhi==="ç”³"&&tZhi==="å¯…")) list.push({n:"ì¸ì‚¬ì‹  í˜•", t:"bad"});
            if((dayZhi==="ä¸‘"&&tZhi==="æˆŒ")||(dayZhi==="æˆŒ"&&tZhi==="æœª")||(dayZhi==="æœª"&&tZhi==="ä¸‘")) list.push({n:"ì¶•ìˆ ë¯¸ í˜•", t:"bad"});
            if((dayZhi==="å­"&&tZhi==="å¯")||(dayZhi==="å¯"&&tZhi==="å­")) list.push({n:"ìë¬˜ í˜•", t:"bad"});
            if(dayZhi===tZhi && ["è¾°","åˆ","é…‰","äº¥"].includes(dayZhi)) list.push({n:"ìí˜•", t:"bad"});

            const pa = {"å­":"é…‰", "é…‰":"å­", "ä¸‘":"è¾°", "è¾°":"ä¸‘", "å¯…":"äº¥", "äº¥":"å¯…", "å¯":"åˆ", "åˆ":"å¯", "å·³":"ç”³", "ç”³":"å·³", "æœª":"æˆŒ", "æˆŒ":"æœª"};
            if(pa[dayZhi] === tZhi) list.push({n:"íŒŒ(ç ´)", t:"bad"});

            const hae = {"å­":"æœª", "æœª":"å­", "ä¸‘":"åˆ", "åˆ":"ä¸‘", "å¯…":"å·³", "å·³":"å¯…", "å¯":"è¾°", "è¾°":"å¯", "ç”³":"äº¥", "äº¥":"ç”³", "é…‰":"æˆŒ", "æˆŒ":"é…‰"};
            if(hae[dayZhi] === tZhi) list.push({n:"í•´(å®³)", t:"bad"});

            if(["ç”²å¯…","ä¹™å·³","ä¸å·³","æˆŠç”³","è¾›äº¥"].includes(tGan+tZhi)) list.push({n:"ê³ ë€ì‚´", t:"bad"});
            if(["ç”²å­","ä¹™äº¥","ä¸™å¯…","ä¸å¯","æˆŠåˆ","å·±å·³","åºšè¾°","åºšæˆŒ","è¾›æœª","è¾›ä¸‘","å£¬ç”³","ç™¸é…‰"].includes(tGan+tZhi)) list.push({n:"íš¨ì‹ ì‚´", t:"bad"});
            
            if(dayZhi==="å¯…" && ["å¯…","å·³","ç”³"].includes(tZhi)) list.push({n:"íƒ•í™”ì‚´", t:"bad"});
            if(dayZhi==="åˆ" && ["åˆ","è¾°","äº¥"].includes(tZhi)) list.push({n:"íƒ•í™”ì‚´", t:"bad"});
            if(dayZhi==="ä¸‘" && ["åˆ","æˆŒ","æœª"].includes(tZhi)) list.push({n:"íƒ•í™”ì‚´", t:"bad"});

            const zhiOrder = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
            const yIdx = zhiOrder.indexOf(yearZhi);
            const tIdx = zhiOrder.indexOf(tZhi);
            if(tIdx === (yIdx+2)%12) list.push({n:"ìƒë¬¸ì‚´", t:"bad"});
            if(tIdx === (yIdx-2+12)%12) list.push({n:"ì¡°ê°ì‚´", t:"bad"});

            let base = "";
            if(["å¯…","åˆ","æˆŒ"].includes(yearZhi)) base = "fire";
            else if(["ç”³","å­","è¾°"].includes(yearZhi)) base = "water";
            else if(["äº¥","å¯","æœª"].includes(yearZhi)) base = "wood";
            else if(["å·³","é…‰","ä¸‘"].includes(yearZhi)) base = "metal";
            
            const s12 = {
                "fire": {"äº¥":"ê²ì‚´","å­":"ì¬ì‚´","ä¸‘":"ì²œì‚´","å¯…":"ì§€ì‚´","å¯":"ë…„ì‚´","è¾°":"ì›”ì‚´","å·³":"ë§ì‹ ","åˆ":"ì¥ì„±","æœª":"ë°˜ì•ˆ","ç”³":"ì—­ë§ˆ","é…‰":"ìœ¡í•´","æˆŒ":"í™”ê°œ"},
                "water": {"å·³":"ê²ì‚´","åˆ":"ì¬ì‚´","æœª":"ì²œì‚´","ç”³":"ì§€ì‚´","é…‰":"ë…„ì‚´","æˆŒ":"ì›”ì‚´","äº¥":"ë§ì‹ ","å­":"ì¥ì„±","ä¸‘":"ë°˜ì•ˆ","å¯…":"ì—­ë§ˆ","å¯":"ìœ¡í•´","è¾°":"í™”ê°œ"},
                "wood": {"ç”³":"ê²ì‚´","é…‰":"ì¬ì‚´","æˆŒ":"ì²œì‚´","äº¥":"ì§€ì‚´","å­":"ë…„ì‚´","ä¸‘":"ì›”ì‚´","å¯…":"ë§ì‹ ","å¯":"ì¥ì„±","è¾°":"ë°˜ì•ˆ","å·³":"ì—­ë§ˆ","åˆ":"ìœ¡í•´","æœª":"í™”ê°œ"},
                "metal": {"å¯…":"ê²ì‚´","å¯":"ì¬ì‚´","è¾°":"ì²œì‚´","å·³":"ì§€ì‚´","åˆ":"ë…„ì‚´","æœª":"ì›”ì‚´","ç”³":"ë§ì‹ ","é…‰":"ì¥ì„±","æˆŒ":"ë°˜ì•ˆ","äº¥":"ì—­ë§ˆ","å­":"ìœ¡í•´","ä¸‘":"í™”ê°œ"}
            };
            
            if(base && s12[base][tZhi]) {
                let sName = s12[base][tZhi];
                let sType = ["ì¥ì„±","ë°˜ì•ˆ","ì²œì„"].includes(sName) ? "good" : ["ê²ì‚´","ì¬ì‚´","ë§ì‹ "].includes(sName) ? "bad" : "neu";
                
                if(sName==="ë…„ì‚´") sName="ë„í™”ì‚´";
                else if(sName==="ì§€ì‚´") sName="ì§€ì‚´"; // ê·¸ëŒ€ë¡œ
                else if(sName==="ì—­ë§ˆ") sName="ì—­ë§ˆì‚´";
                else if(sName==="í™”ê°œ") sName="í™”ê°œì‚´";
                else if(sName==="ë§ì‹ ") sName="ë§ì‹ ì‚´";
                else if(sName==="ì¥ì„±") sName="ì¥ì„±ì‚´";
                else if(sName==="ë°˜ì•ˆ") sName="ë°˜ì•ˆì‚´";
                else if(sName==="ìœ¡í•´") sName="ìœ¡í•´ì‚´";
                
                list.push({n:sName, t:sType});
            }

            const gmMap = {
                "ç”²å­":"æˆŒäº¥", "ä¹™ä¸‘":"æˆŒäº¥", "ä¸™å¯…":"æˆŒäº¥", "ä¸å¯":"æˆŒäº¥", "æˆŠè¾°":"æˆŒäº¥", "å·±å·³":"æˆŒäº¥", "åºšåˆ":"æˆŒäº¥", "è¾›æœª":"æˆŒäº¥", "å£¬ç”³":"æˆŒäº¥", "ç™¸é…‰":"æˆŒäº¥",
                "ç”²æˆŒ":"ç”³é…‰", "ä¹™äº¥":"ç”³é…‰", "ä¸™å­":"ç”³é…‰", "ä¸ä¸‘":"ç”³é…‰", "æˆŠå¯…":"ç”³é…‰", "å·±å¯":"ç”³é…‰", "åºšè¾°":"ç”³é…‰", "è¾›å·³":"ç”³é…‰", "å£¬åˆ":"ç”³é…‰", "ç™¸æœª":"ç”³é…‰",
                "ç”²ç”³":"åˆæœª", "ä¹™é…‰":"åˆæœª", "ä¸™æˆŒ":"åˆæœª", "ä¸äº¥":"åˆæœª", "æˆŠå­":"åˆæœª", "å·±ä¸‘":"åˆæœª", "åºšå¯…":"åˆæœª", "è¾›å¯":"åˆæœª", "å£¬è¾°":"åˆæœª", "ç™¸å·³":"åˆæœª",
                "ç”²åˆ":"è¾°å·³", "ä¹™æœª":"è¾°å·³", "ä¸™ç”³":"è¾°å·³", "ä¸é…‰":"è¾°å·³", "æˆŠæˆŒ":"è¾°å·³", "å·±äº¥":"è¾°å·³", "åºšå­":"è¾°å·³", "è¾›ä¸‘":"è¾°å·³", "å£¬å¯…":"è¾°å·³", "ç™¸å¯":"è¾°å·³",
                "ç”²è¾°":"å¯…å¯", "ä¹™å·³":"å¯…å¯", "ä¸™åˆ":"å¯…å¯", "ä¸æœª":"å¯…å¯", "æˆŠç”³":"å¯…å¯", "å·±é…‰":"å¯…å¯", "åºšæˆŒ":"å¯…å¯", "è¾›äº¥":"å¯…å¯", "å£¬å­":"å¯…å¯", "ç™¸ä¸‘":"å¯…å¯",
                "ç”²å¯…":"å­ä¸‘", "ä¹™å¯":"å­ä¸‘", "ä¸™è¾°":"å­ä¸‘", "ä¸å·³":"å­ä¸‘", "æˆŠåˆ":"å­ä¸‘", "å·±æœª":"å­ä¸‘", "åºšç”³":"å­ä¸‘", "è¾›é…‰":"å­ä¸‘", "å£¬æˆŒ":"å­ä¸‘", "ç™¸äº¥":"å­ä¸‘"
            };
            if((gmMap[dayGan+dayZhi]||"").includes(tZhi)) list.push({n:"ê³µë§", t:"neu"});

            const unique = []; const nm = new Set();
            for(let o of list) { if(!nm.has(o.n)) { unique.push(o); nm.add(o.n); } }
            return unique;
        }

        function analyzeSaju() {
            const name = document.getElementById('userName').value;
            const y = parseInt(document.getElementById('yearSelect').value);
            const m = parseInt(document.getElementById('monthSelect').value);
            const d = parseInt(document.getElementById('daySelect').value);
            const hVal = document.getElementById('hourSelect').value;
            
            if(!name) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
            
            const timeUnknown = (hVal === "99");
            const h = timeUnknown ? 12 : parseInt(hVal);

            let lunarObj;
            try {
                if(calendarType === 'solar') lunarObj = Solar.fromYmdHms(y, m, d, h, 0, 0).getLunar();
                else lunarObj = Lunar.fromYmdHms(y, m, d, h, 0, 0);
            } catch(e) { alert("ë‚ ì§œ ì˜¤ë¥˜"); return; }

            const eightChar = lunarObj.getEightChar();
            const pillars = [
                { gan: eightChar.getTimeGan(), zhi: eightChar.getTimeZhi(), title: "ì‹œì£¼" },
                { gan: eightChar.getDayGan(), zhi: eightChar.getDayZhi(), title: "ì¼ì£¼" },
                { gan: eightChar.getMonthGan(), zhi: eightChar.getMonthZhi(), title: "ì›”ì£¼" },
                { gan: eightChar.getYearGan(), zhi: eightChar.getYearZhi(), title: "ë…„ì£¼" }
            ];
            const me = pillars[1].gan;
            const dayZhi = pillars[1].zhi;
            const monthZhi = pillars[2].zhi;
            const yearZhi = pillars[3].zhi;
            
            let html = "";
            let shinsalHtml = "";
            let counts = {"ëª©":0, "í™”":0, "í† ":0, "ê¸ˆ":0, "ìˆ˜":0};
            let total = 0;

            pillars.forEach((p, i) => {
                let isUnknown = (i===0 && timeUnknown);
                let gan = isUnknown ? "?" : p.gan;
                let zhi = isUnknown ? "?" : p.zhi;
                let isMe = (i===1);
                
                let ganTen = isMe ? "ë³¸ì›" : getTenGod(me, gan);
                if(isUnknown) ganTen = "-";
                let zhiTen = isUnknown ? "-" : getTenGod(me, ZHI_MAIN[zhi]);
                let wunsung = isUnknown ? "-" : getWunsung(me, zhi);
                
                html += `
                    <div class="pillar-box ${isMe?'me':''}">
                        <span class="pillar-title">${p.title}</span>
                        <span class="ten-god-tag">${ganTen}</span>
                        <div class="char-box">
                            <span class="hanja ${isUnknown?'':COLOR_CLASS[WUXING[gan]]}">${gan}</span>
                            <span class="hangul">${isUnknown?'-':WUXING[gan]}</span>
                        </div>
                        <div class="char-box">
                            <span class="hanja ${isUnknown?'':COLOR_CLASS[WUXING[zhi]]}">${zhi}</span>
                            <span class="hangul">${isUnknown?'-':WUXING[zhi]}</span>
                        </div>
                        <span class="sub-info">[${zhiTen}]</span>
                        <span class="sub-info">${wunsung}</span>
                    </div>
                `;

                // ì‹ ì‚´ ì¹´ë“œ
                let sals = isUnknown ? [] : getExtendedShinsal(me, dayZhi, monthZhi, yearZhi, p);
                let salTags = sals.length > 0 
                    ? sals.map(s => {
                        let desc = SHINSAL_DESC[s.n] || "ì„¤ëª… ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.";
                        desc = desc.replace(/'/g, "\\'");
                        return `<span class="ss-tag ${s.t==='good'?'ss-good':s.t==='bad'?'ss-bad':'ss-neu'}" onclick="showToast('${desc}')">${s.n}</span>`;
                    }).join('')
                    : `<span style="font-size:0.8rem; color:#64748b;">-</span>`;

                shinsalHtml += `
                    <div class="shinsal-box">
                        <div class="shinsal-title">${p.title}</div>
                        <div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center;">${salTags}</div>
                    </div>
                `;

                if(!isUnknown) {
                    counts[WUXING[gan]]++; counts[WUXING[zhi]]++;
                    total+=2;
                }
            });

            document.getElementById('sajuGrid').innerHTML = html;
            document.getElementById('shinsalDetail').innerHTML = shinsalHtml;

            document.getElementById('cnt-wood').innerText = counts["ëª©"];
            document.getElementById('cnt-fire').innerText = counts["í™”"];
            document.getElementById('cnt-earth').innerText = counts["í† "];
            document.getElementById('cnt-metal').innerText = counts["ê¸ˆ"];
            document.getElementById('cnt-water').innerText = counts["ìˆ˜"];

            let barHtml = "";
            const order = ["ëª©", "í™”", "í† ", "ê¸ˆ", "ìˆ˜"];
            const classes = ["wood", "fire", "earth", "metal", "water"];
            order.forEach((k, idx) => {
                if(counts[k]>0) {
                    let pct = (counts[k]/total)*100;
                    barHtml += `<div class="ohaeng-seg ${classes[idx]}" style="width:${pct}%"></div>`;
                }
            });
            document.getElementById('ohaengBar').innerHTML = barHtml;

            const yearGanIdx = GAN.indexOf(pillars[3].gan);
            const isYearYang = (yearGanIdx%2===0);
            const isMale = (gender === 'm');
            let isForward = (isYearYang && isMale) || (!isYearYang && !isMale);
            document.getElementById('directionText').innerText = isForward ? "ìˆœí–‰" : "ì—­í–‰";

            let dwHtml = "";
            let sGan = GAN.indexOf(pillars[2].gan);
            let sZhi = ZHI.indexOf(pillars[2].zhi);
            for(let i=1; i<=10; i++) {
                if(isForward) { sGan=(sGan+1)%10; sZhi=(sZhi+1)%12; }
                else { sGan=(sGan-1+10)%10; sZhi=(sZhi-1+12)%12; }
                
                let dGan = GAN[sGan]; let dZhi = ZHI[sZhi];
                dwHtml += `
                    <div class="daewoon-card">
                        <span style="font-size:0.8rem; display:block; margin-bottom:5px;">${i*10}</span>
                        <span style="font-family:serif; font-size:1.4rem; display:block;" class="${COLOR_CLASS[WUXING[dGan]]}">${dGan}</span>
                        <span style="font-family:serif; font-size:1.4rem; display:block;" class="${COLOR_CLASS[WUXING[dZhi]]}">${dZhi}</span>
                        <span style="font-size:0.7rem; color:var(--text-sub); margin-top:5px; display:block;">${getTenGod(me, dGan)}</span>
                    </div>
                `;
            }
            document.getElementById('daewoonList').innerHTML = dwHtml;
            
            document.getElementById('result-area').style.display = 'block';
            window.scrollTo({ top: document.getElementById('result-area').offsetTop - 80, behavior: 'smooth' });
        }
    </script>
</body>
</html>