<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïö¥Ï†ê - Ï†ïÌÜµ ÎßåÏÑ∏Î†• (Final)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.6.12/lunar.js"></script>
    <style>
        @font-face {
            font-family: 'ThinRounded';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/ThinDungGeunMo.woff2') format('woff2');
            font-weight: normal; font-style: normal; font-display: swap;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #00f2ff; border-radius: 10px; }

        body {
            font-family: 'ThinRounded', sans-serif;
            background-color: #020617; /* Îî• ÎÑ§Ïù¥ÎπÑ */
            color: #e2e8f0;
            line-height: 1.6; overflow-x: hidden; font-size: 16px;
        }

        /* Î†àÏù¥ÏïÑÏõÉ */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px;
            background-color: #0f172a; display: flex; justify-content: space-between;
            align-items: center; padding: 0 30px; z-index: 1000; border-bottom: 1px solid #1e293b;
        }
        .logo { font-size: 2.2rem; color: #00f2ff; text-decoration: none; font-weight: bold; text-shadow: 0 0 10px rgba(0, 242, 255, 0.4); }
        .top-menu { display: flex; gap: 20px; }
        .top-menu a { color: #cbd5e1; text-decoration: none; font-size: 1.1rem; cursor: pointer; }

        .sidebar {
            position: fixed; top: 80px; left: 0; width: 280px;
            height: calc(100vh - 80px); background-color: #0f172a;
            padding: 25px; overflow-y: auto; border-right: 1px solid #1e293b;
        }
        .category-title { font-size: 1.3rem; color: #38bdf8; margin-bottom: 12px; display: block; border-bottom: 1px solid #1e293b; padding-bottom: 5px; }
        .sub-menu { list-style: none; padding-left: 10px; }
        .sub-menu li { margin: 10px 0; }
        .sub-menu a { color: #94a3b8; text-decoration: none; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        .sub-menu a:hover { color: #00f2ff; padding-left: 5px; }

        main {
            margin-top: 80px; margin-left: 280px;
            padding: 60px 40px; display: flex; justify-content: center;
        }
        .fortune-page { width: 100%; max-width: 1100px; text-align: center; }
        .page-title { font-size: 2.8rem; color: #00f2ff; margin-bottom: 35px; text-shadow: 0 0 15px rgba(0, 242, 255, 0.3); }

        /* ÏûÖÎ†• Ìèº */
        .input-card {
            background: rgba(15, 23, 42, 0.95); padding: 40px; border-radius: 15px;
            border: 1px solid #38bdf8; text-align: left; box-shadow: 0 0 20px rgba(0, 242, 255, 0.1);
        }
        .input-row { margin-bottom: 25px; }
        .input-row label { display: block; margin-bottom: 10px; color: #38bdf8; font-size: 1.2rem; }
        .select-group { display: flex; gap: 10px; width: 100%; }
        select, input[type="text"] {
            flex: 1; padding: 12px; background-color: #1e293b; color: #e2e8f0;
            border: 1px solid #334155; border-radius: 8px; font-family: 'ThinRounded'; font-size: 1.1rem;
            height: 55px; cursor: pointer; outline: none;
        }
        select:focus, input:focus { border-color: #00f2ff; }
        
        .type-toggle { display: flex; gap: 10px; margin-top: 10px; }
        .type-btn { flex: 1; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid #334155; color: #94a3b8; border-radius: 8px; cursor: pointer; text-align: center; font-size: 1.1rem; }
        .type-btn.active { background: #0ea5e9; color: #fff; border-color: #00f2ff; font-weight: bold; }
        .gender-group { display: flex; gap: 20px; margin-bottom: 10px; }
        .radio-label { flex: 1; padding: 15px; background: #1e293b; border: 1px solid #334155; border-radius: 8px; cursor: pointer; text-align: center; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        input[type="radio"] { margin-right: 10px; accent-color: #00f2ff; transform: scale(1.3); }
        input[type="radio"]:checked + span { color: #00f2ff; font-weight: bold; }
        
        .submit-btn {
            width: 100%; padding: 20px; background: linear-gradient(45deg, #0ea5e9, #3b82f6); color: #fff;
            border: none; border-radius: 8px; font-size: 1.6rem; font-weight: bold; cursor: pointer; margin-top: 25px; transition: 0.3s;
        }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(14, 165, 233, 0.6); }

        #result-area { margin-top: 60px; display: none; text-align: left; animation: fadeIn 0.8s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Í≤∞Í≥º ÌÖåÏù¥Î∏î */
        .manse-table {
            width: 100%; border-collapse: separate; border-spacing: 0; margin-bottom: 30px;
            border: 2px solid #00f2ff; background: #0f172a; border-radius: 10px; overflow: hidden; table-layout: fixed;
        }
        .manse-table th { background: #1e293b; color: #00f2ff; padding: 15px; border-bottom: 2px solid #00f2ff; font-size: 1.3rem; border-right: 1px solid #334155; width:25%; }
        .manse-table td { padding: 15px 5px; text-align: center; border-right: 1px solid #334155; vertical-align: top; }
        .manse-table th:last-child, .manse-table td:last-child { border-right: none; }

        .pillar-char { font-size: 3rem; font-weight: bold; display: block; margin: 5px 0; font-family: serif; line-height: 1.1; }
        .sibsin-label { font-size: 0.95rem; color: #94a3b8; font-weight:bold; display: block; margin-bottom: 5px; height: 20px; }
        .zhi-sibsin { font-size: 0.85rem; color: #64748b; margin-top:5px; display:block; }
        .wunsung-badge { display: inline-block; background: #334155; color: #cbd5e1; padding: 3px 8px; border-radius: 4px; font-size: 0.85rem; margin-top: 5px; }

        /* Ïã†ÏÇ¥ Î∞ïÏä§ */
        .shinsal-box { 
            margin-top: 12px; border-top: 1px dashed #334155; padding-top: 8px; 
            display: flex; flex-wrap: wrap; justify-content: center; gap: 4px; 
        }
        .sal-tag { 
            font-size: 0.75rem; padding: 3px 6px; border-radius: 4px; font-weight: bold; border: 1px solid; 
        }
        /* Í∏∏Ïã†: Ï¥àÎ°ù, ÌùâÏã†: Îπ®Í∞ï, ÌèâÏã†: ÌååÎûë */
        .sal-good { background: rgba(52, 211, 153, 0.15); color: #34d399; border-color: #10b981; } 
        .sal-bad { background: rgba(244, 63, 94, 0.15); color: #fb7185; border-color: #f43f5e; } 
        .sal-neu { background: rgba(96, 165, 250, 0.15); color: #60a5fa; border-color: #3b82f6; } 

        .wood { color: #4ade80; text-shadow: 0 0 5px rgba(74, 222, 128, 0.4); } 
        .fire { color: #fb7185; text-shadow: 0 0 5px rgba(251, 113, 133, 0.4); } 
        .earth { color: #facc15; text-shadow: 0 0 5px rgba(250, 204, 21, 0.4); } 
        .metal { color: #e2e8f0; text-shadow: 0 0 5px rgba(226, 232, 240, 0.4); } 
        .water { color: #60a5fa; text-shadow: 0 0 5px rgba(96, 165, 250, 0.4); }

        .analysis-section { 
            margin-bottom: 50px; background: rgba(15, 23, 42, 0.9); padding: 40px; border-radius: 15px; 
            border: 1px solid #1e293b; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .section-header { 
            font-size: 1.8rem; color: #00f2ff; margin-bottom: 25px; border-bottom: 2px solid #0ea5e9; 
            padding-bottom: 10px; font-weight:bold;
        }

        .daewoon-grid {
            display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px;
            background: #0f172a; padding: 20px; border-radius: 10px; border: 1px solid #334155; text-align: center;
        }
        .daewoon-item { padding: 10px 0; border-right: 1px dashed #334155; }
        .daewoon-item:last-child { border-right: none; }
        .dw-age { display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 5px; }
        .dw-ganzhi { display: block; font-size: 1.4rem; font-weight: bold; font-family: serif; }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            main { margin-left: 0; padding: 20px; }
            .daewoon-grid { grid-template-columns: repeat(5, 1fr); gap: 15px; }
            .daewoon-item { border-bottom: 1px dashed #334155; border-right: none; padding: 15px 0; }
            .pillar-char { font-size: 2.2rem; }
            .page-title { font-size: 2.2rem; }
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="logo">Ïö¥Ï†ê ÎßåÏÑ∏Î†•</a>
        <nav class="top-menu">
            <a>Ïö¥ÏÑ∏</a><a>ÏÇ¨Ï£º</a><a>Ïó∞Ïï†</a>
        </nav>
    </header>

    <aside class="sidebar">
        <div class="menu-category">
            <span class="category-title">ÎßåÏÑ∏Î†• ÌíÄÏù¥</span>
            <ul class="sub-menu">
                <li><a href="#" style="color:#00f2ff; font-weight:bold;">Ï†ïÌÜµ ÎßåÏÑ∏Î†•</a></li>
                <li><a>ÎÇ¥ ÏÇ¨Ï£º ÌíÄÏù¥</a></li>
            </ul>
        </div>
    </aside>

    <main>
        <div class="fortune-page">
            <h2 class="page-title">Ï†ïÌÜµ ÏÇ¨Ï£º Ï†ïÎ∞Ä Î∂ÑÏÑù</h2>
            <div class="input-card">
                <div class="input-row">
                    <label>Ïù¥Î¶Ñ</label>
                    <input type="text" id="userName" placeholder="ÏÑ±Ìï®ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî">
                </div>
                <div class="input-row">
                    <label>ÏÑ±Î≥Ñ</label>
                    <div class="gender-group">
                        <label class="radio-label"><input type="radio" name="gender" value="m" checked> <span>ÎÇ®ÏÑ±</span></label>
                        <label class="radio-label"><input type="radio" name="gender" value="f"> <span>Ïó¨ÏÑ±</span></label>
                    </div>
                </div>
                <div class="input-row">
                    <label>ÏÉùÎÖÑÏõîÏùº</label>
                    <div class="select-group">
                        <select id="yearSelect"></select>
                        <select id="monthSelect"></select>
                        <select id="daySelect"></select>
                    </div>
                    <div class="type-toggle">
                        <div id="solarBtn" class="type-btn active" onclick="setCalendar('solar')">ÏñëÎ†•</div>
                        <div id="lunarBtn" class="type-btn" onclick="setCalendar('lunar')">ÏùåÎ†•</div>
                    </div>
                </div>
                <div class="input-row">
                    <label>ÌÉúÏñ¥ÎÇú ÏãúÍ∞Ñ</label>
                    <select id="hourSelect">
                        <option value="99">Î™®Î¶Ñ (ÏãúÏ£º ÎπÑÏõÄ)</option>
                        <option value="0">ÏûêÏãú (23:30 ~ 01:29)</option><option value="2">Ï∂ïÏãú (01:30 ~ 03:29)</option>
                        <option value="4">Ïù∏Ïãú (03:30 ~ 05:29)</option><option value="6">Î¨òÏãú (05:30 ~ 07:29)</option>
                        <option value="8">ÏßÑÏãú (07:30 ~ 09:29)</option><option value="10">ÏÇ¨Ïãú (09:30 ~ 11:29)</option>
                        <option value="12">Ïò§Ïãú (11:30 ~ 13:29)</option><option value="14">ÎØ∏Ïãú (13:30 ~ 15:29)</option>
                        <option value="16">Ïã†Ïãú (15:30 ~ 17:29)</option><option value="18">Ïú†Ïãú (17:30 ~ 19:29)</option>
                        <option value="20">Ïà†Ïãú (19:30 ~ 21:29)</option><option value="22">Ìï¥Ïãú (21:30 ~ 23:29)</option>
                    </select>
                </div>
                <button class="submit-btn" onclick="analyzeSaju()">ÎßåÏÑ∏Î†• Ï°∞ÌöåÌïòÍ∏∞</button>
            </div>

            <div id="result-area">
                <div class="analysis-section">
                    <h3 class="section-header">üìú ÎßåÏÑ∏Î†• (Four Pillars)</h3>
                    <table class="manse-table">
                        <thead>
                            <tr><th>ÏãúÏ£º</th><th>ÏùºÏ£º (Î≥∏Ïù∏)</th><th>ÏõîÏ£º</th><th>ÎÖÑÏ£º</th></tr>
                        </thead>
                        <tbody id="sajuBody"></tbody>
                    </table>
                </div>

                <div class="analysis-section">
                    <h3 class="section-header">üåä ÎåÄÏö¥Ïùò ÌùêÎ¶Ñ</h3>
                    <div id="daewoonDisplay" class="daewoon-grid"></div>
                    <p style="margin-top:20px; color:#94a3b8;">* ÎåÄÏö¥ Î∞©Ìñ•: <span style="color:#00f2ff" id="directionText"></span></p>
                </div>
            </div>
        </div>
    </main>

    <script>
        window.onload = function() {
            const ys = document.getElementById('yearSelect');
            const ms = document.getElementById('monthSelect');
            const ds = document.getElementById('daySelect');
            ys.innerHTML = ""; ms.innerHTML = ""; ds.innerHTML = "";
            for(let i=2026; i>=1930; i--) { let opt = document.createElement("option"); opt.value = i; opt.innerText = i + "ÎÖÑ"; ys.appendChild(opt); }
            for(let i=1; i<=12; i++) { let opt = document.createElement("option"); opt.value = i; opt.innerText = i + "Ïõî"; ms.appendChild(opt); }
            for(let i=1; i<=31; i++) { let opt = document.createElement("option"); opt.value = i; opt.innerText = i + "Ïùº"; ds.appendChild(opt); }
        };

        let calendarType = 'solar';
        function setCalendar(type) {
            calendarType = type;
            document.getElementById('solarBtn').classList.toggle('active', type === 'solar');
            document.getElementById('lunarBtn').classList.toggle('active', type === 'lunar');
        }

        const GAN = ["Áî≤", "‰πô", "‰∏ô", "‰∏Å", "Êàä", "Â∑±", "Â∫ö", "Ëæõ", "Â£¨", "Áô∏"];
        const ZHI = ["Â≠ê", "‰∏ë", "ÂØÖ", "ÂçØ", "Ëæ∞", "Â∑≥", "Âçà", "Êú™", "Áî≥", "ÈÖâ", "Êàå", "‰∫•"];
        const WUXING = {
            "Áî≤":"Î™©", "‰πô":"Î™©", "ÂØÖ":"Î™©", "ÂçØ":"Î™©",
            "‰∏ô":"Ìôî", "‰∏Å":"Ìôî", "Â∑≥":"Ìôî", "Âçà":"Ìôî",
            "Êàä":"ÌÜ†", "Â∑±":"ÌÜ†", "Ëæ∞":"ÌÜ†", "Êàå":"ÌÜ†", "‰∏ë":"ÌÜ†", "Êú™":"ÌÜ†",
            "Â∫ö":"Í∏à", "Ëæõ":"Í∏à", "Áî≥":"Í∏à", "ÈÖâ":"Í∏à",
            "Â£¨":"Ïàò", "Áô∏":"Ïàò", "‰∫•":"Ïàò", "Â≠ê":"Ïàò"
        };
        const COLOR_CLASS = {"Î™©":"wood", "Ìôî":"fire", "ÌÜ†":"earth", "Í∏à":"metal", "Ïàò":"water"};
        const YIN_YANG = {
            "Áî≤":1, "‰πô":0, "‰∏ô":1, "‰∏Å":0, "Êàä":1, "Â∑±":0, "Â∫ö":1, "Ëæõ":0, "Â£¨":1, "Áô∏":0,
            "Â≠ê":1, "‰∏ë":0, "ÂØÖ":1, "ÂçØ":0, "Ëæ∞":1, "Â∑≥":0, "Âçà":1, "Êú™":0, "Áî≥":1, "ÈÖâ":0, "Êàå":1, "‰∫•":0
        };
        const ZHI_MAIN_GAN = {
            "Â≠ê":"Áô∏", "‰∏ë":"Â∑±", "ÂØÖ":"Áî≤", "ÂçØ":"‰πô", "Ëæ∞":"Êàä", "Â∑≥":"‰∏ô",
            "Âçà":"‰∏Å", "Êú™":"Â∑±", "Áî≥":"Â∫ö", "ÈÖâ":"Ëæõ", "Êàå":"Êàä", "‰∫•":"Â£¨"
        };

        // Ïã≠Ïã† (ÏùºÍ∞Ñ vs ÌÉÄÍ≤ü) - Ï†ïÌôïÌïú Î°úÏßÅ Ïú†ÏßÄ
        function getTenGodStrict(meGan, target) {
            if(!target) return "";
            const wMe = WUXING[meGan]; const wT = WUXING[target];
            const pMe = YIN_YANG[meGan]; const pT = YIN_YANG[target];
            const samePol = (pMe === pT);

            if (wMe === wT) return samePol ? "ÎπÑÍ≤¨" : "Í≤ÅÏû¨";
            if ((wMe==="Î™©"&&wT==="Ìôî")||(wMe==="Ìôî"&&wT==="ÌÜ†")||(wMe==="ÌÜ†"&&wT==="Í∏à")||(wMe==="Í∏à"&&wT==="Ïàò")||(wMe==="Ïàò"&&wT==="Î™©")) return samePol ? "ÏãùÏã†" : "ÏÉÅÍ¥Ä";
            if ((wMe==="Î™©"&&wT==="ÌÜ†")||(wMe==="Ìôî"&&wT==="Í∏à")||(wMe==="ÌÜ†"&&wT==="Ïàò")||(wMe==="Í∏à"&&wT==="Î™©")||(wMe==="Ïàò"&&wT==="Ìôî")) return samePol ? "Ìé∏Ïû¨" : "Ï†ïÏû¨";
            if ((wT==="Î™©"&&wMe==="ÌÜ†")||(wT==="Ìôî"&&wMe==="Í∏à")||(wT==="ÌÜ†"&&wMe==="Ïàò")||(wT==="Í∏à"&&wMe==="Î™©")||(wT==="Ïàò"&&wMe==="Ìôî")) return samePol ? "Ìé∏Í¥Ä" : "Ï†ïÍ¥Ä";
            if ((wT==="Î™©"&&wMe==="Ìôî")||(wT==="Ìôî"&&wMe==="ÌÜ†")||(wT==="ÌÜ†"&&wMe==="Í∏à")||(wT==="Í∏à"&&wMe==="Ïàò")||(wT==="Ïàò"&&wMe==="Î™©")) return samePol ? "Ìé∏Ïù∏" : "Ï†ïÏù∏";
            return "";
        }

        // ÏßÄÏßÄ Ïã≠Ïã† (Î≥∏Í∏∞ Í∏∞Ï§Ä)
        function getZhiTenGod(meGan, zhi) {
            if(!zhi) return "";
            return getTenGodStrict(meGan, ZHI_MAIN_GAN[zhi]);
        }

        // 12Ïö¥ÏÑ±
        const WUNSUNG_LIST = ["Ïû•ÏÉù","Î™©Ïöï","Í¥ÄÎåÄ","Í±¥Î°ù","Ï†úÏôï","Ïá†","Î≥ë","ÏÇ¨","Î¨ò","Ï†à","ÌÉú","Ïñë"];
        function getWunsung(dayGan, zhi) {
            if(!zhi) return "";
            const zhiIdx = ZHI.indexOf(zhi);
            let startIdx=0; let isForward=true;
            if (dayGan==="Áî≤") startIdx=11;
            else if (dayGan==="‰πô") { startIdx=6; isForward=false; }
            else if (dayGan==="‰∏ô"||dayGan==="Êàä") startIdx=2;
            else if (dayGan==="‰∏Å"||dayGan==="Â∑±") { startIdx=9; isForward=false; }
            else if (dayGan==="Â∫ö") startIdx=5;
            else if (dayGan==="Ëæõ") { startIdx=0; isForward=false; }
            else if (dayGan==="Â£¨") startIdx=8;
            else if (dayGan==="Áô∏") { startIdx=3; isForward=false; }
            
            let idx = isForward ? (zhiIdx - startIdx + 12)%12 : (startIdx - zhiIdx + 12)%12;
            return WUNSUNG_LIST[idx];
        }

        // ‚òÖ Ïã†ÏÇ¥ Î°úÏßÅ Í≤ÄÏàò ÏôÑÎ£å ‚òÖ
        function checkAllShinsal(dayGan, dayZhi, yearZhi, pillar) {
            if(!pillar.zhi) return [];
            let list = [];
            const tGan = pillar.gan;
            const tZhi = pillar.zhi;

            // 1. Ï≤úÏùÑÍ∑ÄÏù∏ (ÏùºÍ∞Ñ Í∏∞Ï§Ä)
            if((dayGan==="Áî≤"||dayGan==="Êàä"||dayGan==="Â∫ö") && (tZhi==="‰∏ë"||tZhi==="Êú™")) list.push({n:"Ï≤úÏùÑÍ∑ÄÏù∏", t:"good"});
            if((dayGan==="‰πô"||dayGan==="Â∑±") && (tZhi==="Â≠ê"||tZhi==="Áî≥")) list.push({n:"Ï≤úÏùÑÍ∑ÄÏù∏", t:"good"});
            if((dayGan==="‰∏ô"||dayGan==="‰∏Å") && (tZhi==="‰∫•"||tZhi==="ÈÖâ")) list.push({n:"Ï≤úÏùÑÍ∑ÄÏù∏", t:"good"});
            if((dayGan==="Ëæõ") && (tZhi==="Âçà"||tZhi==="ÂØÖ")) list.push({n:"Ï≤úÏùÑÍ∑ÄÏù∏", t:"good"});
            if((dayGan==="Â£¨"||dayGan==="Áô∏") && (tZhi==="Â∑≥"||tZhi==="ÂçØ")) list.push({n:"Ï≤úÏùÑÍ∑ÄÏù∏", t:"good"});

            // 2. Î∞±Ìò∏ÏÇ¥ (Í∞ÑÏßÄ) - Ï†ïÌôïÌïú Î¶¨Ïä§Ìä∏
            if(["Áî≤Ëæ∞","‰πôÊú™","‰∏ôÊàå","‰∏Å‰∏ë","ÊàäËæ∞","Â£¨Êàå","Áô∏‰∏ë"].includes(tGan+tZhi)) list.push({n:"Î∞±Ìò∏ÎåÄÏÇ¥", t:"bad"});
            
            // 3. Í¥¥Í∞ïÏÇ¥ (Í∞ÑÏßÄ)
            if(["Â∫öËæ∞","Â∫öÊàå","Â£¨Ëæ∞","Â£¨Êàå","ÊàäÊàå"].includes(tGan+tZhi)) list.push({n:"Í¥¥Í∞ïÏÇ¥", t:"bad"});

            // 4. ÏñëÏù∏ÏÇ¥ (ÏùºÍ∞Ñ Í∏∞Ï§Ä ÏßÄÏßÄ) - ÏñëÍ∞ÑÏùò Ï†úÏôïÏßÄ
            if((dayGan==="Áî≤"&&tZhi==="ÂçØ")||(dayGan==="‰∏ô"&&tZhi==="Âçà")||(dayGan==="Êàä"&&tZhi==="Âçà")||(dayGan==="Â∫ö"&&tZhi==="ÈÖâ")||(dayGan==="Â£¨"&&tZhi==="Â≠ê")) list.push({n:"ÏñëÏù∏ÏÇ¥", t:"bad"});

            // 5. ÌòÑÏπ®ÏÇ¥ (Í∏ÄÏûê ÏûêÏ≤¥)
            if(["Áî≤","Áî≥","ÂçØ","Âçà","Ëæõ"].includes(tGan) || ["Áî≤","Áî≥","ÂçØ","Âçà","Ëæõ"].includes(tZhi)) list.push({n:"ÌòÑÏπ®ÏÇ¥", t:"neu"});

            // 6. Í∑ÄÎ¨∏Í¥ÄÏÇ¥ (ÏùºÏßÄ Í∏∞Ï§Ä)
            const gwi = {"Â≠ê":"ÈÖâ", "ÈÖâ":"Â≠ê", "‰∏ë":"Âçà", "Âçà":"‰∏ë", "ÂØÖ":"Êú™", "Êú™":"ÂØÖ", "ÂçØ":"Áî≥", "Áî≥":"ÂçØ", "Ëæ∞":"‰∫•", "‰∫•":"Ëæ∞", "Â∑≥":"Êàå", "Êàå":"Â∑≥"};
            if(gwi[dayZhi] === tZhi) list.push({n:"Í∑ÄÎ¨∏Í¥ÄÏÇ¥", t:"bad"});

            // 7. ÏõêÏßÑÏÇ¥ (ÏùºÏßÄ Í∏∞Ï§Ä)
            const won = {"Â≠ê":"Êú™", "Êú™":"Â≠ê", "‰∏ë":"Âçà", "Âçà":"‰∏ë", "ÂØÖ":"ÈÖâ", "ÈÖâ":"ÂØÖ", "ÂçØ":"Áî≥", "Áî≥":"ÂçØ", "Ëæ∞":"‰∫•", "‰∫•":"Ëæ∞", "Â∑≥":"Êàå", "Êàå":"Â∑≥"};
            if(won[dayZhi] === tZhi) list.push({n:"ÏõêÏßÑÏÇ¥", t:"bad"});

            // 8. Ï∂© (ÏùºÏßÄ Í∏∞Ï§Ä)
            const chung = {"Â≠ê":"Âçà", "Âçà":"Â≠ê", "‰∏ë":"Êú™", "Êú™":"‰∏ë", "ÂØÖ":"Áî≥", "Áî≥":"ÂØÖ", "ÂçØ":"ÈÖâ", "ÈÖâ":"ÂçØ", "Ëæ∞":"Êàå", "Êàå":"Ëæ∞", "Â∑≥":"‰∫•", "‰∫•":"Â∑≥"};
            if(chung[dayZhi] === tZhi) list.push({n:"Ï∂©(Ê≤ñ)", t:"bad"});

            // 9. 12Ïã†ÏÇ¥ (ÎÖÑÏßÄ Í∏∞Ï§Ä) - Ï†ïÏÑù (ÎÖÑÏßÄ ÏÇºÌï©Íµ≠ Í∏∞Ï§Ä)
            let baseGroup = "";
            if(["ÂØÖ","Âçà","Êàå"].includes(yearZhi)) baseGroup = "fire"; // Ïù∏Ïò§Ïà† ÌôîÍµ≠
            else if(["Áî≥","Â≠ê","Ëæ∞"].includes(yearZhi)) baseGroup = "water"; // Ïã†ÏûêÏßÑ ÏàòÍµ≠
            else if(["‰∫•","ÂçØ","Êú™"].includes(yearZhi)) baseGroup = "wood"; // Ìï¥Î¨òÎØ∏ Î™©Íµ≠
            else if(["Â∑≥","ÈÖâ","‰∏ë"].includes(yearZhi)) baseGroup = "metal"; // ÏÇ¨Ïú†Ï∂ï Í∏àÍµ≠
            
            const shinsal12 = {
                "fire": {"‰∫•":"Í≤ÅÏÇ¥","Â≠ê":"Ïû¨ÏÇ¥","‰∏ë":"Ï≤úÏÇ¥","ÂØÖ":"ÏßÄÏÇ¥","ÂçØ":"ÎÖÑÏÇ¥","Ëæ∞":"ÏõîÏÇ¥","Â∑≥":"ÎßùÏã†","Âçà":"Ïû•ÏÑ±","Êú™":"Î∞òÏïà","Áî≥":"Ïó≠Îßà","ÈÖâ":"Ïú°Ìï¥","Êàå":"ÌôîÍ∞ú"},
                "water": {"Â∑≥":"Í≤ÅÏÇ¥","Âçà":"Ïû¨ÏÇ¥","Êú™":"Ï≤úÏÇ¥","Áî≥":"ÏßÄÏÇ¥","ÈÖâ":"ÎÖÑÏÇ¥","Êàå":"ÏõîÏÇ¥","‰∫•":"ÎßùÏã†","Â≠ê":"Ïû•ÏÑ±","‰∏ë":"Î∞òÏïà","ÂØÖ":"Ïó≠Îßà","ÂçØ":"Ïú°Ìï¥","Ëæ∞":"ÌôîÍ∞ú"},
                "wood": {"Áî≥":"Í≤ÅÏÇ¥","ÈÖâ":"Ïû¨ÏÇ¥","Êàå":"Ï≤úÏÇ¥","‰∫•":"ÏßÄÏÇ¥","Â≠ê":"ÎÖÑÏÇ¥","‰∏ë":"ÏõîÏÇ¥","ÂØÖ":"ÎßùÏã†","ÂçØ":"Ïû•ÏÑ±","Ëæ∞":"Î∞òÏïà","Â∑≥":"Ïó≠Îßà","Âçà":"Ïú°Ìï¥","Êú™":"ÌôîÍ∞ú"},
                "metal": {"ÂØÖ":"Í≤ÅÏÇ¥","ÂçØ":"Ïû¨ÏÇ¥","Ëæ∞":"Ï≤úÏÇ¥","Â∑≥":"ÏßÄÏÇ¥","Âçà":"ÎÖÑÏÇ¥","Êú™":"ÏõîÏÇ¥","Áî≥":"ÎßùÏã†","ÈÖâ":"Ïû•ÏÑ±","Êàå":"Î∞òÏïà","‰∫•":"Ïó≠Îßà","Â≠ê":"Ïú°Ìï¥","‰∏ë":"ÌôîÍ∞ú"}
            };
            if(baseGroup && shinsal12[baseGroup][tZhi]) {
                let sName = shinsal12[baseGroup][tZhi];
                let sType = ["Ïû•ÏÑ±","Î∞òÏïà","Ï≤úÏùÑ"].includes(sName) ? "good" : ["Í≤ÅÏÇ¥","Ïû¨ÏÇ¥","ÎßùÏã†"].includes(sName) ? "bad" : "neu";
                if(sName === "ÎÖÑÏÇ¥") sName = "ÎèÑÌôî(ÎÖÑÏÇ¥)";
                if(sName === "Ïó≠Îßà") sName = "Ïó≠Îßà(ÏßÄÏÇ¥)"; // 12Ïã†ÏÇ¥ Ïó≠Îßà
                list.push({n:sName, t:sType});
            }

            // 10. Í≥µÎßù (ÏùºÏ£º Í∏∞Ï§Ä)
            const gongmangMap = {
                "Áî≤Â≠ê":"Êàå‰∫•", "‰πô‰∏ë":"Êàå‰∫•", "‰∏ôÂØÖ":"Êàå‰∫•", "‰∏ÅÂçØ":"Êàå‰∫•", "ÊàäËæ∞":"Êàå‰∫•", "Â∑±Â∑≥":"Êàå‰∫•", "Â∫öÂçà":"Êàå‰∫•", "ËæõÊú™":"Êàå‰∫•", "Â£¨Áî≥":"Êàå‰∫•", "Áô∏ÈÖâ":"Êàå‰∫•",
                "Áî≤Êàå":"Áî≥ÈÖâ", "‰πô‰∫•":"Áî≥ÈÖâ", "‰∏ôÂ≠ê":"Áî≥ÈÖâ", "‰∏Å‰∏ë":"Áî≥ÈÖâ", "ÊàäÂØÖ":"Áî≥ÈÖâ", "Â∑±ÂçØ":"Áî≥ÈÖâ", "Â∫öËæ∞":"Áî≥ÈÖâ", "ËæõÂ∑≥":"Áî≥ÈÖâ", "Â£¨Âçà":"Áî≥ÈÖâ", "Áô∏Êú™":"Áî≥ÈÖâ",
                "Áî≤Áî≥":"ÂçàÊú™", "‰πôÈÖâ":"ÂçàÊú™", "‰∏ôÊàå":"ÂçàÊú™", "‰∏Å‰∫•":"ÂçàÊú™", "ÊàäÂ≠ê":"ÂçàÊú™", "Â∑±‰∏ë":"ÂçàÊú™", "Â∫öÂØÖ":"ÂçàÊú™", "ËæõÂçØ":"ÂçàÊú™", "Â£¨Ëæ∞":"ÂçàÊú™", "Áô∏Â∑≥":"ÂçàÊú™",
                "Áî≤Âçà":"Ëæ∞Â∑≥", "‰πôÊú™":"Ëæ∞Â∑≥", "‰∏ôÁî≥":"Ëæ∞Â∑≥", "‰∏ÅÈÖâ":"Ëæ∞Â∑≥", "ÊàäÊàå":"Ëæ∞Â∑≥", "Â∑±‰∫•":"Ëæ∞Â∑≥", "Â∫öÂ≠ê":"Ëæ∞Â∑≥", "Ëæõ‰∏ë":"Ëæ∞Â∑≥", "Â£¨ÂØÖ":"Ëæ∞Â∑≥", "Áô∏ÂçØ":"Ëæ∞Â∑≥",
                "Áî≤Ëæ∞":"ÂØÖÂçØ", "‰πôÂ∑≥":"ÂØÖÂçØ", "‰∏ôÂçà":"ÂØÖÂçØ", "‰∏ÅÊú™":"ÂØÖÂçØ", "ÊàäÁî≥":"ÂØÖÂçØ", "Â∑±ÈÖâ":"ÂØÖÂçØ", "Â∫öÊàå":"ÂØÖÂçØ", "Ëæõ‰∫•":"ÂØÖÂçØ", "Â£¨Â≠ê":"ÂØÖÂçØ", "Áô∏‰∏ë":"ÂØÖÂçØ",
                "Áî≤ÂØÖ":"Â≠ê‰∏ë", "‰πôÂçØ":"Â≠ê‰∏ë", "‰∏ôËæ∞":"Â≠ê‰∏ë", "‰∏ÅÂ∑≥":"Â≠ê‰∏ë", "ÊàäÂçà":"Â≠ê‰∏ë", "Â∑±Êú™":"Â≠ê‰∏ë", "Â∫öÁî≥":"Â≠ê‰∏ë", "ËæõÈÖâ":"Â≠ê‰∏ë", "Â£¨Êàå":"Â≠ê‰∏ë", "Áô∏‰∫•":"Â≠ê‰∏ë"
            };
            let myGM = gongmangMap[dayGan+dayZhi] || "";
            if(myGM.includes(tZhi)) list.push({n:"Í≥µÎßù", t:"neu"});

            // Ï§ëÎ≥µ Ï†úÍ±∞
            const unique = []; const names = new Set();
            for(let s of list) { if(!names.has(s.n)) { unique.push(s); names.add(s.n); } }
            return unique;
        }

        function analyzeSaju() {
            const name = document.getElementById('userName').value;
            const y = document.getElementById('yearSelect').value;
            const m = document.getElementById('monthSelect').value;
            const d = document.getElementById('daySelect').value;
            const hVal = document.getElementById('hourSelect').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;

            if(!name || !y || !m || !d) { alert("Ï†ïÎ≥¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî."); return; }

            const timeUnknown = (hVal === "99");
            const h = timeUnknown ? 12 : parseInt(hVal); // Î™®Î•¥Î©¥ 12ÏãúÎ°ú Í≥ÑÏÇ∞ÌïòÎêò ÎÇòÏ§ëÏóê Í∞ÄÎ¶º

            let lunarObj;
            try {
                if(calendarType === 'solar') lunarObj = Solar.fromYmdHms(parseInt(y), parseInt(m), parseInt(d), h, 0, 0).getLunar();
                else lunarObj = Lunar.fromYmdHms(parseInt(y), parseInt(m), parseInt(d), h, 0, 0);
            } catch(e) { alert("ÎÇ†Ïßú Ïò§Î•ò"); return; }

            const eightChar = lunarObj.getEightChar();
            const pillars = [
                { gan: eightChar.getTimeGan(), zhi: eightChar.getTimeZhi() }, // Ïãú
                { gan: eightChar.getDayGan(), zhi: eightChar.getDayZhi() },   // Ïùº
                { gan: eightChar.getMonthGan(), zhi: eightChar.getMonthZhi() }, // Ïõî
                { gan: eightChar.getYearGan(), zhi: eightChar.getYearZhi() }    // ÎÖÑ
            ];
            const me = pillars[1].gan;
            const dayZhi = pillars[1].zhi;
            const yearZhi = pillars[3].zhi;

            let html = `<tr>`;

            for(let i=0; i<4; i++) {
                // ÏãúÍ∞Ñ Î™®Î¶Ñ Ï≤òÎ¶¨
                if(i===0 && timeUnknown) {
                    html += `<td>
                        <span class="ten-god" style="color:#334155;">-</span>
                        <span class="pillar-char" style="color:#334155;">?</span>
                        <span class="pillar-char" style="color:#334155;">?</span>
                        <span style="font-size:0.8rem; color:#64748b;">ÏãúÍ∞Ñ ÎØ∏Ï†ï</span>
                    </td>`;
                    continue;
                }

                let p = pillars[i];
                let ganSibsin = (i===1) ? "Î≥∏Ïõê" : getTenGodStrict(me, p.gan);
                let zhiSibsin = getZhiTenGod(me, p.zhi);
                let wunsung = getWunsung(me, p.zhi);
                let sals = checkAllShinsal(me, dayZhi, yearZhi, p);
                
                let salHtml = sals.map(s => `<span class="sal-tag ${s.t==='good'?'sal-good':s.t==='bad'?'sal-bad':'sal-neu'}">${s.n}</span>`).join("");

                html += `
                    <td>
                        <span class="ten-god">${ganSibsin}</span>
                        <span class="pillar-char ${COLOR_CLASS[WUXING[p.gan]]}">${p.gan}</span>
                        <span class="pillar-char ${COLOR_CLASS[WUXING[p.zhi]]}">${p.zhi}</span>
                        <span class="zhi-sibsin">[${zhiSibsin}]</span>
                        <span class="wunsung-badge">${wunsung}</span>
                        <div class="shinsal-box">
                             ${salHtml}
                        </div>
                    </td>
                `;
            }
            html += `</tr>`;
            document.getElementById('sajuBody').innerHTML = html;

            // ÎåÄÏö¥
            const yearGanIndex = GAN.indexOf(pillars[3].gan);
            const isYearYang = yearGanIndex % 2 === 0;
            const isMale = gender === 'm';
            let isForward = (isYearYang && isMale) || (!isYearYang && !isMale);
            document.getElementById('directionText').innerText = isForward ? "ÏàúÌñâ" : "Ïó≠Ìñâ";

            let daewoonHtml = "";
            let startIdxGan = GAN.indexOf(pillars[2].gan);
            let startIdxZhi = ZHI.indexOf(pillars[2].zhi);

            for(let i=1; i<=10; i++) {
                if(isForward) {
                    startIdxGan = (startIdxGan + 1) % 10;
                    startIdxZhi = (startIdxZhi + 1) % 12;
                } else {
                    startIdxGan = (startIdxGan - 1 + 10) % 10;
                    startIdxZhi = (startIdxZhi - 1 + 12) % 12;
                }
                let dGan = GAN[startIdxGan];
                let dZhi = ZHI[startIdxZhi];
                let dwSibsin = getTenGodStrict(me, dGan);

                daewoonHtml += `
                    <div class="daewoon-item">
                        <span class="dw-age">${i*10}</span>
                        <span class="dw-ganzhi">
                            <span class="${COLOR_CLASS[WUXING[dGan]]}">${dGan}</span>
                            <span class="${COLOR_CLASS[WUXING[dZhi]]}">${dZhi}</span>
                        </span>
                        <span style="font-size:0.75rem; color:#64748b; margin-top:5px; display:block;">${dwSibsin}</span>
                    </div>
                `;
            }
            document.getElementById('daewoonDisplay').innerHTML = daewoonHtml;
            document.getElementById('result-area').style.display = 'block';
            window.scrollTo({ top: document.getElementById('result-area').offsetTop - 100, behavior: 'smooth' });
        }
    </script>
</body>
</html>