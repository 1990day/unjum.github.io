<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HIPHAN AI ê´€ìƒ í…ŒìŠ¤íŠ¸</title>
    <style>
        :root {
            --hip-gradient: linear-gradient(135deg, #833ab4 0%, #fd1d1d 50%, #fcb045 100%);
            --aurora-gradient: linear-gradient(135deg, #FF00CC 0%, #333399 100%);
            --text-main: #262626;
            --text-sub: #8e8e8e;
            --bg-color: #fafafa;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-color); margin: 0; padding: 20px;
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
        }

        .container {
            background: #ffffff; border: 1px solid #dbdbdb;
            border-radius: 15px; width: 100%; max-width: 450px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden;
        }

        .section { display: none; padding: 40px 20px; text-align: center; }
        .section.active { display: block; animation: fadeEffect 0.6s ease; }
        @keyframes fadeEffect { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }

        h1 {
            font-size: 1.8rem; margin-bottom: 10px;
            background: var(--aurora-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            font-weight: 900; letter-spacing: -0.5px;
        }
        .sub-text { color: var(--text-sub); margin-bottom: 30px; font-size: 0.95rem; line-height: 1.6; }

        .circle-img {
            width: 180px; height: 180px; border-radius: 50%; object-fit: cover;
            margin-bottom: 30px; padding: 4px; background: var(--aurora-gradient);
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            background: var(--aurora-gradient); color: white; border: none; padding: 16px 0;
            font-size: 1.1rem; font-weight: 700; border-radius: 30px; cursor: pointer; width: 100%;
            transition: 0.3s; box-shadow: 0 5px 15px rgba(255, 0, 204, 0.3); margin-bottom: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-save { background: #262626; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-outline { background: white; border: 2px solid #e0e0e0; color: var(--text-main); box-shadow: none; }

        #file-upload { display: none; }
        .upload-box {
            border: 2px dashed #dcb0ff; padding: 50px 20px; border-radius: 20px;
            cursor: pointer; background: #fdfaff; transition: 0.3s;
        }
        .upload-box:hover { border-color: #FF00CC; background: #fff0fa; }

        /* ê²°ê³¼ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        #result-section { padding: 0; text-align: left; }
        
        /* â˜… ìº¡ì²˜ ëŒ€ìƒ ì˜ì—­ (ì´ ë¶€ë¶„ë§Œ ì´ë¯¸ì§€ë¡œ ì €ì¥ë¨) â˜… */
        #capture-target {
            background: white; /* íˆ¬ëª… ë°°ê²½ ë°©ì§€ */
            padding-bottom: 20px;
        }

        .insta-header {
            padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #eee;
        }
        .header-avatar {
            width: 35px; height: 35px; border-radius: 50%; margin-right: 10px;
            padding: 2px; background: var(--hip-gradient);
        }
        .header-text { font-weight: 700; font-size: 0.95rem; }

        .result-img-wrapper {
            width: 100%; aspect-ratio: 1/1; overflow: hidden;
            display: flex; justify-content: center; align-items: center; background: #000;
        }
        #result-photo { width: 100%; height: 100%; object-fit: cover; }

        .result-info-area {
            padding: 25px 20px; text-align: center;
            background: linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,0,204,0.05) 100%);
        }
        .job-title {
            font-size: 2.2rem; font-weight: 900; margin: 0; line-height: 1.2;
            background: var(--aurora-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            word-break: keep-all; letter-spacing: -1px;
        }
        .age-info {
            font-size: 1rem; color: #888; margin-top: 10px; font-weight: 500;
            display: inline-block; padding: 5px 15px; background: #f5f5f5; border-radius: 20px;
        }

        .caption-area { padding: 0 20px; font-size: 0.95rem; line-height: 1.6; color: #333; }
        .caption-id { font-weight: 800; margin-right: 6px; }

        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #FF00CC; border-radius: 50%;
            width: 45px; height: 45px; animation: spin 1s linear infinite; margin: 30px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>

<div class="container">
    <div id="loading-section" class="section active">
        <div class="loader"></div>
        <h2 style="font-size:1.2rem;">AI ë°ì´í„° ë¡œë”© ì¤‘...</h2>
    </div>

    <div id="main-section" class="section">
        <h1>HIPHAN<br>AI ê´€ìƒ í…ŒìŠ¤íŠ¸</h1>
        <p class="sub-text">ë‚´ ì–¼êµ´ì— ìˆ¨ê²¨ì§„ í™í•œ ì§ì—…ê³¼<br>ì†Œë¦„ ë‹ëŠ” ìš´ëª…ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
        <img src="https://images.unsplash.com/photo-1516575334481-f85287c2c81d?w=500&auto=format&fit=crop&q=60" class="circle-img" alt="main">
        <button class="btn" onclick="goToUpload()">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="upload-section" class="section">
        <h2 style="margin-bottom:10px;">Face Check</h2>
        <p class="sub-text">ì •ë©´ ì‚¬ì§„ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.</p>
        <label for="file-upload" class="upload-box" style="display:block;">
            <span style="font-size: 2.5rem;">ğŸ“¸</span><br>
            <span style="font-weight:bold; color:#FF00CC;">ì‚¬ì§„ ì„ íƒí•˜ê¸°</span>
        </label>
        <input type="file" id="file-upload" accept="image/*" onchange="previewImage(event)">
        <div id="preview-area" style="display:none; margin-top:20px;">
            <img id="preview-img" class="circle-img" style="width:120px; height:120px;">
            <button id="analyze-btn" class="btn" onclick="analyzeFace()">ì´ ì‚¬ì§„ìœ¼ë¡œ ë¶„ì„</button>
        </div>
    </div>

    <div id="result-section" class="section">
        
        <div id="capture-target">
            <div class="insta-header">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="header-avatar" crossorigin="anonymous">
                <span class="header-text">ai_face_scanner</span>
                <span style="margin-left:auto; font-size:1.5rem;">ğŸ”¥</span>
            </div>

            <div class="result-img-wrapper">
                <img id="result-photo" src="" crossorigin="anonymous">
            </div>

            <div class="result-info-area">
                <h2 id="res-job" class="job-title">ì§ì—… ë¶„ì„ ì¤‘...</h2>
                <div class="age-info">ê´€ìƒ ë‚˜ì´: <span id="res-age">20</span>ì„¸</div>
            </div>

            <div style="padding: 0 20px 10px 20px; font-size:1.6rem;">
                <span>â¤ï¸</span> <span>ğŸ’¬</span> <span>âœˆï¸</span>
            </div>

            <div class="caption-area">
                <p>
                    <span class="caption-id">ai_face_scanner</span>
                    <span id="res-desc"></span>
                </p>
                <p style="color:#8e8e8e; font-size:0.8rem; margin-top:10px;">
                    #ê´€ìƒ #AI #í™í•œê´€ìƒ #ì„±ê²©í…ŒìŠ¤íŠ¸
                </p>
            </div>
        </div>
        <div style="padding: 20px;">
            <button class="btn btn-save" onclick="saveImage()">ğŸ“¥ ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°</button>
            <button class="btn btn-outline" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>
    </div>
</div>

<script>
    const MODEL_URL = 'https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@master/weights';

    const JOBS = {
        youth: ["ì „êµíšŒì¥", "ì•„ì´ëŒ ì„¼í„°ìƒ", "ë§ŒëŠ¥ ì—”í„°í…Œì´ë„ˆ", "ì²´ìœ¡ë¶€ì¥", "ì›¹íˆ° ì‘ê°€ ì§€ë§ìƒ", "ìœ íŠœë¸Œ ì‹¤ë²„ë²„íŠ¼ ë³´ìœ ì", "ì „êµ 1ë“±", "ì²œì¬ í•´ì»¤", "íŒ¨ì…˜ ì¸í”Œë£¨ì–¸ì„œ", "ì‡¼ë¯¸ë”ë¨¸ë‹ˆ ìš°ìŠ¹ í›„ë³´", "í•µì¸ì‹¸ ë™ì•„ë¦¬ íšŒì¥", "ì—„ì¹œì•„/ì—„ì¹œë”¸"],
        money: ["ì²­ë‹´ë™ ê±´ë¬¼ì£¼", "ë¹„íŠ¸ì½”ì¸ ëŒ€ë°•ë‚œ ë¶€ì", "ìœ ë‹ˆì½˜ ê¸°ì—… CEO", "ë‹¤ì´ì•„ ìˆ˜ì €", "ëª…í’ˆ ë¸Œëœë“œ VIP", "ì‚¬ëª¨í€ë“œ ë§¤ë‹ˆì €", "ì˜ì•¤ë¦¬ì¹˜ ë˜í¼", "ê°•ë‚¨ í°ì†", "í˜¸í…” ì²´ì¸ ì˜¤ë„ˆ", "í”„ëœì°¨ì´ì¦ˆ ëŒ€í‘œ", "ì„ìœ  ì¬ë²Œ"],
        art: ["ì¹¸ ì˜í™”ì œ ì´ˆì²­ ê°ë…", "ì²œì¬ íƒ€íˆ¬ì´ìŠ¤íŠ¸", "í™í•© í”„ë¡œë“€ì„œ", "ë² ìŠ¤íŠ¸ì…€ëŸ¬ ì‘ê°€", "ì„±ìˆ˜ë™ í™í•œ ì¹´í˜ ì‚¬ì¥", "íŒ¨ì…˜ ë””ìì´ë„ˆ", "ì¸ë””ë°´ë“œ ë³´ì»¬", "ë©”ì´í¬ì—… ì•„í‹°ìŠ¤íŠ¸", "í˜„ëŒ€ë¯¸ìˆ  ì‘ê°€", "ìŠ¤íŠ¸ë¦¿ ëŒ„ì„œ", "ë®¤ì§€ì»¬ ë°°ìš°"],
        power: ["ì²­ì™€ëŒ€ ë¹„ì„œì‹¤ì¥ê¸‰", "ëŒ€ê¸°ì—… ìµœì—°ì†Œ ì„ì›", "ì¹´ë¦¬ìŠ¤ë§ˆ ê°•ë ¥ê³„ ë°˜ì¥", "êµ­ê°€ëŒ€í‘œ ê°ë…", "í˜‘ìƒ ì „ë¬¸ê°€", "ë‰´ìŠ¤ ì•µì»¤", "ìŠ¤íƒ€ ë³€í˜¸ì‚¬", "ë…¸ì¡° ìœ„ì›ì¥", "ëŒ€í•™ ì´ì¥", "ì •ì¹˜ê³„ ê±°ë¬¼"],
        service: ["ë¯¸ìŠë­ 3ìŠ¤íƒ€ ì…°í”„", "í¼ìŠ¤ë„ ì‡¼í¼", "ë°˜ë ¤ë™ë¬¼ í–‰ë™êµì •ì‚¬", "ì¼íƒ€ ê°•ì‚¬", "ìŠ¹ë¬´ì›", "ì—°ì•  ì»¨ì„¤í„´íŠ¸", "ì‹¬ë¦¬ ìƒë‹´ê°€", "ì™€ì¸ ì†Œë¯ˆë¦¬ì—", "í˜¸í…” ì§€ë°°ì¸", "ì›¨ë”© í”Œë˜ë„ˆ", "í•„ë¼í…ŒìŠ¤ ì›ì¥ë‹˜"],
        tech: ["íŒêµ AI ê°œë°œì", "NASA ì—°êµ¬ì›", "í™”ì´íŠ¸ í•´ì»¤", "ì²œì¬ ì™¸ê³¼ì˜ì‚¬", "ê±´ì¶•ê°€", "í”„ë¡œíŒŒì¼ëŸ¬", "ë¸”ë¡ì²´ì¸ ì „ë¬¸ê°€", "ì‹ ì•½ ê°œë°œì", "ì²œì²´ ë¬¼ë¦¬í•™ì", "ë¡œë´‡ ê³µí•™ì"]
    };

    const DESC_PARTS = {
        eyes: ["ëˆˆë¹›ì— ê¹Šì€ ì„œì‚¬ê°€ ë‹´ê²¨ìˆìœ¼ë©°,", "ìƒëŒ€ë¥¼ ê¿°ëš«ì–´ ë³´ëŠ” í†µì°°ë ¥ ìˆëŠ” ëˆˆë§¤ì™€,", "ì›ƒì„ ë•Œ ì„¸ìƒì„ ë¬´ì¥í•´ì œ ì‹œí‚¤ëŠ” ëˆˆì›ƒìŒê³¼,", "ì•¼ë§ì´ ì´ê¸€ê±°ë¦¬ëŠ” ê°•ë ¬í•œ ëˆˆë¹›ê³¼,", "ë„í™”ì‚´ì´ í˜ëŸ¬ë„˜ì¹˜ëŠ” ì¹˜ëª…ì ì¸ ëˆˆë§¤ì™€,"],
        nose: ["ë³µì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë‘¥ê¸€ê³  ë„í†°í•œ ì½”,", "ìì¡´ì‹¬ì´ ëŠê»´ì§€ëŠ” ì˜¤ë˜‘í•˜ê³  ë‚ ë µí•œ ì½”,", "ì¬ë¬¼ìš´ì´ ìŸì•„ì ¸ ë“¤ì–´ì˜¬ íŠ¼íŠ¼í•œ ì½§ëŒ€,", "ì§€ì ì¸ ì´ë¯¸ì§€ë¥¼ ì™„ì„±í•˜ëŠ” ì„¸ë ¨ëœ ì½” ë¼ì¸,"],
        vibe_happy: ["ì£¼ë³€ì„ í™˜í•˜ê²Œ ë°íˆëŠ” 'ì¸ê°„ ë¹„íƒ€ë¯¼' ê°™ì€ ì—ë„ˆì§€ê°€ ëŠê»´ì§‘ë‹ˆë‹¤.", "ì‚¬ëŒì„ ëŒì–´ë‹¹ê¸°ëŠ” ìì„ ê°™ì€ ë§¤ë ¥ì˜ ì†Œìœ ìì…ë‹ˆë‹¤.", "ì–´ë”œ ê°€ë‚˜ ì£¼ì¸ê³µì´ ë˜ëŠ” íƒ€ê³ ë‚œ ì—°ì˜ˆì¸ ê¸°ì§ˆì´ ë³´ì…ë‹ˆë‹¤."],
        vibe_calm: ["ì–´ë–¤ ìƒí™©ì—ì„œë„ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” 'ê°•ì²  ë©˜íƒˆ'ì˜ ì†Œìœ ìì…ë‹ˆë‹¤.", "ì§€ì ì´ê³  ì°¨ë¶„í•œ ì•„ìš°ë¼ë¡œ ì‹ ë¢°ê°ì„ ì£¼ëŠ” ë¦¬ë”í˜•ì…ë‹ˆë‹¤.", "ë‚¨ë“¤ì€ ëª» ë³´ëŠ” 1%ë¥¼ ë°œê²¬í•˜ëŠ” ì²œì¬ì ì¸ ê°ê°ì´ ëŠê»´ì§‘ë‹ˆë‹¤."],
        vibe_strong: ["í•œë²ˆ ë¬¼ë©´ ì ˆëŒ€ ë†“ì§€ ì•ŠëŠ” ë¬´ì„œìš´ ì§‘ë…ê³¼ ìŠ¹ë¶€ìš•ì´ ë³´ì…ë‹ˆë‹¤.", "ì„¸ìƒì„ ë°”ê¿€ë§Œí•œ í˜ëª…ê°€ì˜ ê¸°ì§ˆê³¼ ì¹´ë¦¬ìŠ¤ë§ˆê°€ ë„˜ì¹©ë‹ˆë‹¤.", "ì‘ì€ ë¬¼ì—ì„œ ë†€ê¸°ì—” ê·¸ë¦‡ì´ ë„ˆë¬´ë‚˜ í° 'ëŒ€ë¬¼' ê´€ìƒì…ë‹ˆë‹¤."]
    };

    let isLoaded = false;
    window.onload = async () => {
        try {
            await Promise.all([
                faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),
                faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                faceapi.nets.ageGenderNet.loadFromUri(MODEL_URL),
                faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL)
            ]);
            isLoaded = true;
            document.getElementById('loading-section').classList.remove('active');
            document.getElementById('main-section').classList.add('active');
        } catch(e) { console.error(e); alert("ë¡œë”© ì—ëŸ¬! ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”."); }
    };

    function goToUpload() {
        document.querySelector('.section.active').classList.remove('active');
        document.getElementById('upload-section').classList.add('active');
    }

    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = e => {
            document.getElementById('preview-img').src = e.target.result;
            document.getElementById('preview-area').style.display = 'block';
        };
        if(event.target.files[0]) reader.readAsDataURL(event.target.files[0]);
    }

    function getRandomDesc(mood) {
        const eye = DESC_PARTS.eyes[Math.floor(Math.random() * DESC_PARTS.eyes.length)];
        const nose = DESC_PARTS.nose[Math.floor(Math.random() * DESC_PARTS.nose.length)];
        let vibe = DESC_PARTS.vibe_calm;
        if(['happy', 'surprised'].includes(mood)) vibe = DESC_PARTS.vibe_happy;
        else if(['angry', 'fearful', 'disgusted'].includes(mood)) vibe = DESC_PARTS.vibe_strong;
        return `${eye} ${nose} íŠ¹íˆ ${vibe[Math.floor(Math.random() * vibe.length)]}`;
    }

    async function analyzeFace() {
        if(!isLoaded) return;
        const btn = document.getElementById('analyze-btn');
        btn.innerText = "ë¶„ì„ ì¤‘...";
        
        try {
            const img = document.getElementById('preview-img');
            const detections = await faceapi.detectSingleFace(img).withFaceLandmarks().withAgeAndGender().withFaceExpressions();
            if(!detections) throw new Error("ì–¼êµ´ ì¸ì‹ ì‹¤íŒ¨");

            const age = Math.round(detections.age);
            const ex = detections.expressions;
            const mood = Object.keys(ex).reduce((a, b) => ex[a] > ex[b] ? a : b);

            let cat = 'service';
            if(age < 20) cat = 'youth';
            else if(['angry', 'disgusted'].includes(mood)) cat = 'power';
            else if(['happy'].includes(mood)) cat = 'money';
            else if(['sad', 'fearful'].includes(mood)) cat = 'art';
            else cat = 'tech';
            
            if(age >= 50 && Math.random() > 0.5) cat = 'money';

            const jobList = JOBS[cat];
            const finalJob = jobList[Math.floor(Math.random() * jobList.length)];
            const desc = getRandomDesc(mood);

            // ê²°ê³¼ ì—…ë°ì´íŠ¸
            document.getElementById('result-photo').src = img.src;
            document.getElementById('res-job').innerText = finalJob;
            document.getElementById('res-age').innerText = age;
            document.getElementById('res-desc').innerHTML = `
                <b>[AI ê´€ìƒ ë¶„ì„í‘œ]</b><br>
                ${desc}<br><br>
                ë‹¹ì‹ ì˜ ì–¼êµ´ ê³¨ê²©ê³¼ ë¶„ìœ„ê¸°ë¥¼ ì¢…í•©í–ˆì„ ë•Œ,<br>
                <b>"${finalJob}"</b>ì˜ ìš´ëª…ì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤.
            `;

            document.querySelector('.section.active').classList.remove('active');
            document.getElementById('result-section').classList.add('active');
        } catch(e) {
            alert("ì–¼êµ´ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”. ì •ë©´ ì‚¬ì§„ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„!");
            btn.innerText = "ì´ ì‚¬ì§„ìœ¼ë¡œ ë¶„ì„";
        }
    }

    // â˜… ì´ë¯¸ì§€ ì €ì¥ í•¨ìˆ˜ (HTML2CANVAS) â˜…
    function saveImage() {
        const target = document.getElementById('capture-target');
        const btn = document.querySelector('.btn-save');
        btn.innerText = "ì €ì¥ ì¤‘...";
        
        html2canvas(target, { 
            useCORS: true, // ì™¸ë¶€ ì´ë¯¸ì§€ ë¡œë”© í—ˆìš©
            scale: 2 // ê³ í™”ì§ˆ ì €ì¥
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'hip-face-test.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
            btn.innerText = "ğŸ“¥ ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°";
        }).catch(err => {
            console.error(err);
            alert("ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            btn.innerText = "ğŸ“¥ ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°";
        });
    }
</script>
</body>
</html>